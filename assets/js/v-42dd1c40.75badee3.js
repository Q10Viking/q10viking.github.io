"use strict";(self.webpackChunkq10viking_github_io=self.webpackChunkq10viking_github_io||[]).push([[83754],{25772:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-42dd1c40",path:"/springsecurity/14%20%E6%8E%88%E6%9D%83-%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%88%86%E7%A6%BB.html",title:"",lang:"zh-CN",frontmatter:{sidebarDepth:3,sidebar:"auto",prev:{text:"Back To 目录",link:"/springsecurity/"},"typora-root-url":"..\\.vuepress\\public"},excerpt:"",headers:[{level:2,title:"code模式",slug:"code模式",children:[{level:3,title:"授权服务器",slug:"授权服务器",children:[]}]},{level:2,title:"资源服务器",slug:"资源服务器",children:[]}],filePathRelative:"springsecurity/14 授权-资源服务分离.md"}},84839:(n,s,a)=>{a.r(s),a.d(s,{default:()=>u});var e=a(20641);const t=(0,e.Lk)("h2",{id:"code模式",tabindex:"-1"},[(0,e.Lk)("a",{class:"header-anchor",href:"#code模式","aria-hidden":"true"},"#"),(0,e.eW)(" code模式")],-1),p={href:"https://github.com/Q10Viking/springcloudalibaba/tree/main/oauth2/oauth2-password-update-token",target:"_blank",rel:"noopener noreferrer"},l=(0,e.Fv)('<p><img src="/images/springsecurity/image-20230314151820940.png" alt="image-20230314151820940"></p><h3 id="授权服务器" tabindex="-1"><a class="header-anchor" href="#授权服务器" aria-hidden="true">#</a> 授权服务器</h3><p>用户授权返回code</p><p>http://localhost:8080/oauth/authorize?client_id=client&amp;response_type=code&amp;redirect_uri=http://www.baidu.com</p><p>根据用户授权的code，client获取token</p><p><img src="/images/springsecurity/image-20230314151859530.png" alt="image-20230314151859530"></p><h2 id="资源服务器" tabindex="-1"><a class="header-anchor" href="#资源服务器" aria-hidden="true">#</a> 资源服务器</h2><p>client拿到token访问资源，资源服务器会去授权服务器校验token的合法性</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>\n  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8088</span>\n<span class="token key atrule">spring</span><span class="token punctuation">:</span>\n  <span class="token key atrule">application</span><span class="token punctuation">:</span>\n    <span class="token key atrule">name</span><span class="token punctuation">:</span> oauth2<span class="token punctuation">-</span>resource\n\n  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>\n    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource\n    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver\n    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.135.130<span class="token punctuation">:</span>3306/oauth2_resource<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC</span>\n    <span class="token key atrule">username</span><span class="token punctuation">:</span> root\n    <span class="token key atrule">password</span><span class="token punctuation">:</span> Root.123456\n    <span class="token key atrule">hikari</span><span class="token punctuation">:</span>\n      <span class="token key atrule">minimum-idle</span><span class="token punctuation">:</span> <span class="token number">5</span>\n      <span class="token key atrule">idle-timeout</span><span class="token punctuation">:</span> <span class="token number">600000</span>\n      <span class="token key atrule">maximum-pool-size</span><span class="token punctuation">:</span> <span class="token number">10</span>\n      <span class="token key atrule">auto-commit</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n      <span class="token key atrule">pool-name</span><span class="token punctuation">:</span> MyHikariCP\n      <span class="token key atrule">max-lifetime</span><span class="token punctuation">:</span> <span class="token number">1800000</span>\n      <span class="token key atrule">connection-timeout</span><span class="token punctuation">:</span> <span class="token number">30000</span>\n      <span class="token key atrule">connection-test-query</span><span class="token punctuation">:</span> SELECT 1\n<span class="token key atrule">security</span><span class="token punctuation">:</span>\n  <span class="token key atrule">oauth2</span><span class="token punctuation">:</span>\n    <span class="token key atrule">client</span><span class="token punctuation">:</span>\n      <span class="token key atrule">access-token-uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/oauth/token\n      <span class="token key atrule">user-authorization-uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/oauth/authorize\n      <span class="token key atrule">client-id</span><span class="token punctuation">:</span> client\n      <span class="token key atrule">client-secret</span><span class="token punctuation">:</span> <span class="token number">123123</span>\n    <span class="token key atrule">resource</span><span class="token punctuation">:</span>\n      <span class="token key atrule">id</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>\n      <span class="token key atrule">token-info-uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/oauth/check_token\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div>',9),c={href:"http://localhost:8088/contents/?access_token=814fb968-7188-4c0e-a759-0814b698db0b",target:"_blank",rel:"noopener noreferrer"},o={},u=(0,a(66262).A)(o,[["render",function(n,s){const a=(0,e.g2)("OutboundLink");return(0,e.uX)(),(0,e.CE)(e.FK,null,[t,(0,e.Lk)("p",null,[(0,e.Lk)("a",p,[(0,e.eW)("Source Code"),(0,e.bF)(a)])]),l,(0,e.Lk)("p",null,[(0,e.Lk)("a",c,[(0,e.eW)("localhost:8088/contents/?access_token=814fb968-7188-4c0e-a759-0814b698db0b"),(0,e.bF)(a)])])],64)}]])},66262:(n,s)=>{s.A=(n,s)=>{const a=n.__vccOpts||n;for(const[n,e]of s)a[n]=e;return a}}}]);
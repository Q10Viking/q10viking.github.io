"use strict";(self.webpackChunkq10viking_github_io=self.webpackChunkq10viking_github_io||[]).push([[63021],{28643:(a,s,n)=>{n.r(s),n.d(s,{data:()=>e});const e={key:"v-3d958f3a",path:"/zk/07%20acl%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%AE%9E%E6%88%98.html",title:"",lang:"zh-CN",frontmatter:{sidebarDepth:3,sidebar:"auto",prev:{text:"Back To 目录",link:"/zk/"},"typora-root-url":"..\\.vuepress\\public"},excerpt:"",headers:[{level:2,title:"命令",slug:"命令",children:[]},{level:2,title:"生成授权ID",slug:"生成授权id",children:[]},{level:2,title:"设置ACL",slug:"设置acl",children:[{level:3,title:"创建节点设置acl",slug:"创建节点设置acl",children:[]}]},{level:2,title:"setacl授权方式",slug:"setacl授权方式",children:[]},{level:2,title:"IP授权模式",slug:"ip授权模式",children:[]},{level:2,title:"Super 超级管理员模式",slug:"super-超级管理员模式",children:[]}],filePathRelative:"zk/07 acl权限控制实战.md"}},8830:(a,s,n)=>{n.r(s),n.d(s,{default:()=>t});const e=(0,n(20641).Fv)('<h2 id="命令" tabindex="-1"><a class="header-anchor" href="#命令" aria-hidden="true">#</a> 命令</h2><p>可以通过在zkServer.sh设置系统参数<code>-Dzookeeper.skipACL=yes</code>进行配置，默认是no,可以配置为true, 则配置过的ACL将不再进行权限检测。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>getAcl：获取某个节点的acl权限信息\nsetAcl：设置某个节点的acl权限信息\naddauth: 输入认证授权信息，相当于注册用户信息，注册时输入明文密码，zk将以密文的形式存储 \n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="生成授权id" tabindex="-1"><a class="header-anchor" href="#生成授权id" aria-hidden="true">#</a> 生成授权ID</h2><p>代码生成ID:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>@Test\npublic void generateSuperDigest<span class="token punctuation">(</span><span class="token punctuation">)</span> throws NoSuchAlgorithmException <span class="token punctuation">{</span>\n    String sId <span class="token operator">=</span> DigestAuthenticationProvider.generateDigest<span class="token punctuation">(</span><span class="token string">&quot;hzz:Root.123456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    System.out.println<span class="token punctuation">(</span>sId<span class="token punctuation">)</span><span class="token punctuation">;</span>//  gj:X/NSthOB0fD/OT6iilJ55WJVado<span class="token operator">=</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>或者在控制台生成授权ID</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token operator">&lt;</span>user<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>password<span class="token operator">&gt;</span> <span class="token operator">|</span> openssl dgst <span class="token parameter variable">-binary</span> <span class="token parameter variable">-sha1</span> <span class="token operator">|</span> openssl base64\n<span class="token comment"># 如</span>\n<span class="token punctuation">[</span>root@localhost apache-zookeeper-3.5.8-bin<span class="token punctuation">]</span><span class="token comment"># echo -n hzz:Root.123456 | openssl dgst -binary -sha1 | openssl base64</span>\nUGx4PDnbuDRSn/JjZwR3U/YXmbI<span class="token operator">=</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="设置acl" tabindex="-1"><a class="header-anchor" href="#设置acl" aria-hidden="true">#</a> 设置ACL</h2><blockquote><p>拿到授权ID来设置ACL</p></blockquote><h3 id="创建节点设置acl" tabindex="-1"><a class="header-anchor" href="#创建节点设置acl" aria-hidden="true">#</a> 创建节点设置acl</h3><p><strong>节点创建的同时设置ACL</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>create /zk-node datatest digest:hzz:UGx4PDnbuDRSn/JjZwR3U/YXmbI<span class="token operator">=</span>:cdrwa\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>添加授权信息后，不能直接访问，直接访问将报如下异常</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">15</span><span class="token punctuation">]</span> get /zk-node\norg.apache.zookeeper.KeeperException<span class="token variable">$NoAuthException</span><span class="token builtin class-name">:</span> KeeperErrorCode <span class="token operator">=</span> NoAuth <span class="token keyword">for</span> /zk-node\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>访问前需要添加授权信息</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>addauth digest hzz:Root.123456\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="auth-明文授权⭐" tabindex="-1"><a class="header-anchor" href="#auth-明文授权⭐" aria-hidden="true">#</a> auth 明文授权⭐</h4><p>使用之前需要先<code>addauth digest username:password</code> 注册用户信息，后续可以直接用明文授权，而不用像上面那样先生成那一长字符串</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>addauth digest q10viking:Root.123456\ncreate /node-1  auth:q10viking:Root.123456:cdwra\ncreate /node-1 node1data auth:q10viking:Root.123456:cdwra\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="setacl授权方式" tabindex="-1"><a class="header-anchor" href="#setacl授权方式" aria-hidden="true">#</a> setacl授权方式</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">4</span><span class="token punctuation">]</span> addauth digest q10viking:Root.123456\n<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">5</span><span class="token punctuation">]</span> setAcl /node-1 auth:q10viking:Root.123456:cdwra\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="ip授权模式" tabindex="-1"><a class="header-anchor" href="#ip授权模式" aria-hidden="true">#</a> IP授权模式</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>setAcl /node-ip ip:192.168.109.128:cdwra\ncreate /node-ip  data  ip:192.168.109.128:cdwra\n\n<span class="token comment"># 多个指定IP可以通过逗号分隔， 如 </span>\nsetAcl /node-ip  ip:IP1:rw,ip:IP2:a\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="super-超级管理员模式" tabindex="-1"><a class="header-anchor" href="#super-超级管理员模式" aria-hidden="true">#</a> Super 超级管理员模式</h2><p>这是一种特殊的Digest模式， 在Super模式下超级管理员用户可以对Zookeeper上的节点进行任何的操作。</p><p>需要在zkServer.sh启动了上通过JVM 系统参数开启：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token parameter variable">-Dzookeeper.DigestAuthenticationProvider.superDigest</span><span class="token operator">=</span>super:<span class="token operator">&lt;</span>base64encoded<span class="token punctuation">(</span>SHA1<span class="token punctuation">(</span>password<span class="token punctuation">))</span>\n<span class="token comment"># 如</span>\n<span class="token parameter variable">-Dzookeeper.DigestAuthenticationProvider.superDigest</span><span class="token operator">=</span>hzz:UGx4PDnbuDRSn/JjZwR3U/YXmbI<span class="token operator">=</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div>',28),p={},t=(0,n(66262).A)(p,[["render",function(a,s){return e}]])},66262:(a,s)=>{s.A=(a,s)=>{const n=a.__vccOpts||a;for(const[a,e]of s)n[a]=e;return n}}}]);
"use strict";(self.webpackChunkq10viking_github_io=self.webpackChunkq10viking_github_io||[]).push([[75525],{67616:(a,n,e)=>{e.r(n),e.d(n,{data:()=>s});const s={key:"v-b4d1a728",path:"/seata/08%20SpringBoot-Seata%E9%9B%86%E6%88%90%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C.html",title:"",lang:"zh-CN",frontmatter:{sidebarDepth:3,sidebar:"auto",prev:{text:"Back To 目录",link:"/seata/"},"typora-root-url":"..\\.vuepress\\public"},excerpt:"",headers:[{level:2,title:"SeataFeignClient",slug:"seatafeignclient",children:[]},{level:2,title:"DataSourceProxy",slug:"datasourceproxy",children:[]},{level:2,title:"@GlobalTransactional的扫面AOP",slug:"globaltransactional的扫面aop",children:[]},{level:2,title:"Java代码",slug:"java代码",children:[]}],filePathRelative:"seata/08 SpringBoot-Seata集成基础设施准备工作.md"}},54171:(a,n,e)=>{e.r(n),e.d(n,{default:()=>h});var s=e(20641);const t=(0,s.Lk)("h2",{id:"seatafeignclient",tabindex:"-1"},[(0,s.Lk)("a",{class:"header-anchor",href:"#seatafeignclient","aria-hidden":"true"},"#"),(0,s.eW)(" SeataFeignClient")],-1),o=(0,s.Lk)("blockquote",null,[(0,s.Lk)("p",null,"原理在bean的生命周期中替换bean")],-1),r=(0,s.Lk)("blockquote",null,[(0,s.Lk)("p",null,"用于在Feign调用过程中设置请求头的xid（事务全局ID）")],-1),l={href:"https://www.processon.com/view/link/62a1b7807d9c08733ec284e3",target:"_blank",rel:"noopener noreferrer"},i=(0,s.Lk)("p",null,"![08 SpringBoot-Seata集成基础设施(SeataClient)准备工作](/images/seata/08 SpringBoot-Seata集成基础设施(SeataClient)准备工作.png)",-1),c=(0,s.Lk)("h2",{id:"datasourceproxy",tabindex:"-1"},[(0,s.Lk)("a",{class:"header-anchor",href:"#datasourceproxy","aria-hidden":"true"},"#"),(0,s.eW)(" DataSourceProxy")],-1),p=(0,s.Lk)("blockquote",null,[(0,s.Lk)("p",null,"代理连接池DataSource（如DruidDataSource）,在getConnection的时候获得ConectionProxy,在从连接connection获得PrepareStatementProxy")],-1),u={href:"http://seata.io/zh-cn/docs/dev/mode/xa-mode.html",target:"_blank",rel:"noopener noreferrer"},d=(0,s.Fv)('<p><img src="/images/seata/image-20220609172914639.png" alt="image-20220609172914639"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//AutoDataSourceProxyRegistrar#registerBeanDefinitions</span>\n<span class="token class-name">AbstractBeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token class-name">BeanDefinitionBuilder</span>\n                <span class="token punctuation">.</span><span class="token function">genericBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">SeataDataSourceBeanPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>\n                <span class="token punctuation">.</span><span class="token function">addConstructorArgValue</span><span class="token punctuation">(</span>excludes<span class="token punctuation">)</span>\n                <span class="token punctuation">.</span><span class="token function">addConstructorArgValue</span><span class="token punctuation">(</span>dataSourceProxyMode<span class="token punctuation">)</span>\n                <span class="token punctuation">.</span><span class="token function">getBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div>',2),g={href:"https://www.processon.com/view/link/62a1fcfe0791293ad1a59975",target:"_blank",rel:"noopener noreferrer"},k=(0,s.Fv)('<p><img src="/images/seata/SpringBoot-Seata集成基础设施(DataSourceProxy)准备工作.png" alt="SpringBoot-Seata集成基础设施(DataSourceProxy)准备工作"></p><h2 id="globaltransactional的扫面aop" tabindex="-1"><a class="header-anchor" href="#globaltransactional的扫面aop" aria-hidden="true">#</a> @GlobalTransactional的扫面AOP</h2><p>GlobalTransactionScanner 扫描带有@GlobalTransactional的类，生成代理类，执行时走<strong>GlobalTransactionalInterceptor</strong></p><h2 id="java代码" tabindex="-1"><a class="header-anchor" href="#java代码" aria-hidden="true">#</a> Java代码</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>io.seata.spring.annotation.datasource.DataSourceProxyHolder#putDataSource\nFunction&lt;? super K, ? extends V&gt; mappingFunction\n\nBranchType.XA == dataSourceProxyMode ? DataSourceProxyXA::new : DataSourceProxy::new\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>',5),b={},h=(0,e(66262).A)(b,[["render",function(a,n){const e=(0,s.g2)("OutboundLink");return(0,s.uX)(),(0,s.CE)(s.FK,null,[t,o,r,(0,s.Lk)("p",null,[(0,s.Lk)("a",l,[(0,s.eW)("08 SpringBoot-Seata集成基础设施(SeataClient)准备工作 | ProcessOn免费在线作图,在线流程图,在线思维导图 |"),(0,s.bF)(e)])]),i,c,p,(0,s.Lk)("p",null,[(0,s.Lk)("a",u,[(0,s.eW)("Seata XA 模式对比AT模式"),(0,s.bF)(e)])]),d,(0,s.Lk)("p",null,[(0,s.Lk)("a",g,[(0,s.eW)("SpringBoot-Seata集成基础设施(DataSourceProxy)准备工作 | ProcessOn免费在线作图,在线流程图,在线思维导图 |"),(0,s.bF)(e)])]),k],64)}]])},66262:(a,n)=>{n.A=(a,n)=>{const e=a.__vccOpts||a;for(const[a,s]of n)e[a]=s;return e}}}]);
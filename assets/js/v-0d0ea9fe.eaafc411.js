"use strict";(self.webpackChunkq10viking_github_io=self.webpackChunkq10viking_github_io||[]).push([[37112],{63471:(n,a,s)=>{s.r(a),s.d(a,{data:()=>e});const e={key:"v-0d0ea9fe",path:"/gateway/01%20%E6%96%AD%E8%A8%80.html",title:"",lang:"zh-CN",frontmatter:{sidebarDepth:3,sidebar:"auto",prev:{text:"Back To 目录",link:"/gateway/"},"typora-root-url":"..\\.vuepress\\public"},excerpt:"",headers:[{level:2,title:"断言",slug:"断言",children:[]},{level:2,title:"Path断言",slug:"path断言",children:[]},{level:2,title:"Header断言",slug:"header断言",children:[]}],filePathRelative:"gateway/01 断言.md"}},40826:(n,a,s)=>{s.r(a),s.d(a,{default:()=>o});var e=s(20641);const p=(0,e.Lk)("h2",{id:"断言",tabindex:"-1"},[(0,e.Lk)("a",{class:"header-anchor",href:"#断言","aria-hidden":"true"},"#"),(0,e.eW)(" 断言")],-1),t={href:"https://github.com/Q10Viking/springcloudalibaba/tree/main/springcloudgateway/02-gateway-predicates",target:"_blank",rel:"noopener noreferrer"},l=(0,e.Fv)('<div class="custom-container tip"><p class="custom-container-title">TIP</p><p>predicates：路由断言，判断请求是否符合要求，符合则转发到路由目的地。application.yml配置文件中写的断言规则只是字符串，这些字符串会被Predicate Factory读取并处理，转变为路由判断的条件</p></div><blockquote><p>通过网关启动日志，可以查看内置路由断言工厂</p></blockquote><p><img src="/images/gateway/image-20230308114834701.png" alt="image-20230308114834701"></p><h2 id="path断言" tabindex="-1"><a class="header-anchor" href="#path断言" aria-hidden="true">#</a> Path断言</h2><blockquote><p>微服务路由最常用的断言,路径匹配</p></blockquote><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user_route   <span class="token comment">#路由ID，全局唯一，建议配置服务名</span>\n          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//mall<span class="token punctuation">-</span>user  <span class="token comment">#lb 整合负载均衡器ribbon,loadbalancer</span>\n          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>\n            <span class="token punctuation">-</span> Path=/user/<span class="token important">**</span>   <span class="token comment"># 断言，路径相匹配的进行路由</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="header断言" tabindex="-1"><a class="header-anchor" href="#header断言" aria-hidden="true">#</a> Header断言</h2><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>\n  <span class="token key atrule">application</span><span class="token punctuation">:</span>\n    <span class="token key atrule">name</span><span class="token punctuation">:</span> mall<span class="token punctuation">-</span>gateway\n  <span class="token comment">#配置nacos注册中心地址</span>\n  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>\n    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>\n      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>\n        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.135.1<span class="token punctuation">:</span><span class="token number">8848</span>\n\n    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>\n      <span class="token comment">#设置路由：路由id、路由到微服务的uri、断言</span>\n      <span class="token key atrule">routes</span><span class="token punctuation">:</span>\n        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> order_route  <span class="token comment">#路由ID，全局唯一，建议配置服务名</span>\n          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//mall<span class="token punctuation">-</span>order  <span class="token comment">#lb 整合负载均衡器ribbon,loadbalancer</span>\n          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>\n            <span class="token punctuation">-</span> Path=/order/<span class="token important">**</span>   <span class="token comment"># 断言，路径相匹配的进行路由</span>\n\n        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user_route   <span class="token comment">#路由ID，全局唯一，建议配置服务名</span>\n          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//mall<span class="token punctuation">-</span>user  <span class="token comment">#lb 整合负载均衡器ribbon,loadbalancer</span>\n          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>\n            <span class="token punctuation">-</span> Path=/user/<span class="token important">**</span>   <span class="token comment"># 断言，路径相匹配的进行路由</span>\n            <span class="token comment"># Header匹配  请求中带有请求头名为 x-request-id，其值与 \\d+ 正则表达式匹配</span>\n            <span class="token punctuation">-</span> Header=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Id<span class="token punctuation">,</span>\\d+\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>没有相应的请求头断言失败</p><p><img src="/images/gateway/image-20230308120459226.png" alt="image-20230308120459226"></p><p>携带请求头断言成功</p><p><img src="/images/gateway/image-20230308120425048.png" alt="image-20230308120425048"></p>',12),c={},o=(0,s(66262).A)(c,[["render",function(n,a){const s=(0,e.g2)("OutboundLink");return(0,e.uX)(),(0,e.CE)(e.FK,null,[p,(0,e.Lk)("p",null,[(0,e.Lk)("a",t,[(0,e.eW)("Source Code"),(0,e.bF)(s)])]),l],64)}]])},66262:(n,a)=>{a.A=(n,a)=>{const s=n.__vccOpts||n;for(const[n,e]of a)s[n]=e;return s}}}]);
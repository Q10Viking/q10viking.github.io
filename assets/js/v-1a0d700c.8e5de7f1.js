"use strict";(self.webpackChunkq10viking_github_io=self.webpackChunkq10viking_github_io||[]).push([[87560],{44384:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-1a0d700c",path:"/ElasticStack/22%20%E6%90%9C%E7%B4%A2%E6%A8%A1%E6%9D%BF.html",title:"",lang:"zh-CN",frontmatter:{sidebarDepth:3,sidebar:"auto",prev:{text:"Back To 目录",link:"/ElasticStack/"},"typora-root-url":"..\\.vuepress\\public"},excerpt:"",headers:[{level:2,title:"search template",slug:"search-template",children:[]},{level:2,title:"简单定义参数并传递",slug:"简单定义参数并传递",children:[]},{level:2,title:"toJson方式传递参数",slug:"tojson方式传递参数",children:[]},{level:2,title:"join方式传递参数",slug:"join方式传递参数",children:[]},{level:2,title:"default value定义",slug:"default-value定义",children:[]},{level:2,title:"记录template实现重复调用",slug:"记录template实现重复调用",children:[]},{level:2,title:"保存template到ES",slug:"保存template到es",children:[]},{level:2,title:"调用template执行搜索",slug:"调用template执行搜索",children:[]},{level:2,title:"查询已定义的template",slug:"查询已定义的template",children:[]},{level:2,title:"删除已定义的template",slug:"删除已定义的template",children:[]}],filePathRelative:"ElasticStack/22 搜索模板.md"}},86966:(n,s,a)=>{a.r(s),a.d(s,{default:()=>t});const e=(0,a(20641).Fv)('<h2 id="search-template" tabindex="-1"><a class="header-anchor" href="#search-template" aria-hidden="true">#</a> search template</h2><p>搜索模板，search template，高级功能，就可以将我们的一些搜索进行模板化，然后的话，每次执行这个搜索，就直接调用模板，给传入一些参数就可以了</p><h2 id="简单定义参数并传递" tabindex="-1"><a class="header-anchor" href="#简单定义参数并传递" aria-hidden="true">#</a> 简单定义参数并传递</h2><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>GET /cars/_search/template\n<span class="token punctuation">{</span>\n  <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;remark&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{{kw}}&quot;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{{size}}&quot;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;kw&quot;</span><span class="token operator">:</span> <span class="token string">&quot;大众&quot;</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">2</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="tojson方式传递参数" tabindex="-1"><a class="header-anchor" href="#tojson方式传递参数" aria-hidden="true">#</a> toJson方式传递参数</h2><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>GET cars/_search/template\n<span class="token punctuation">{</span>\n  <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>&quot;<span class="token punctuation">{</span> <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>#toJson<span class="token punctuation">}</span><span class="token punctuation">}</span>parameter<span class="token punctuation">{</span><span class="token punctuation">{</span>/toJson<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token string">&quot;&quot;</span>&quot;<span class="token punctuation">,</span>\n  <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;parameter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">&quot;remark&quot;</span><span class="token operator">:</span> <span class="token string">&quot;大众&quot;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="join方式传递参数" tabindex="-1"><a class="header-anchor" href="#join方式传递参数" aria-hidden="true">#</a> join方式传递参数</h2><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>GET cars/_search/template\n<span class="token punctuation">{</span>\n  <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;remark&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{{#join delimiter=&#39; &#39;}}kw{{/join delimiter=&#39; &#39;}}&quot;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;kw&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n      <span class="token string">&quot;大众&quot;</span><span class="token punctuation">,</span>\n      <span class="token string">&quot;标致&quot;</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="default-value定义" tabindex="-1"><a class="header-anchor" href="#default-value定义" aria-hidden="true">#</a> default value定义</h2><p>设置默认值</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>GET cars/_search/template\n<span class="token punctuation">{</span>\n  <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n          <span class="token property">&quot;gte&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{{start}}&quot;</span><span class="token punctuation">,</span>\n          <span class="token property">&quot;lte&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{{end}}{{^end}}200000{{/end}}&quot;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">100000</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="记录template实现重复调用" tabindex="-1"><a class="header-anchor" href="#记录template实现重复调用" aria-hidden="true">#</a> 记录template实现重复调用</h2><p>可以使用Mustache语言作为搜索请求的预处理，它提供了模板，然后通过键值对来替换模板中的变量。es会自动把脚本存储在本地磁盘中，默认的位置为：elasticsearch\\config\\scripts，通过引用脚本名称进行使用</p><h2 id="保存template到es" tabindex="-1"><a class="header-anchor" href="#保存template到es" aria-hidden="true">#</a> 保存template到ES</h2><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>POST _scripts/test\n<span class="token punctuation">{</span>\n  <span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;lang&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mustache&quot;</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n          <span class="token property">&quot;remark&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{{kw}}&quot;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="调用template执行搜索" tabindex="-1"><a class="header-anchor" href="#调用template执行搜索" aria-hidden="true">#</a> 调用template执行搜索</h2><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>GET cars/_search/template\n<span class="token punctuation">{</span>\n  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;kw&quot;</span><span class="token operator">:</span> <span class="token string">&quot;大众&quot;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="/images/elasticsearch/image-20211113053302839.png" alt=""></p><h2 id="查询已定义的template" tabindex="-1"><a class="header-anchor" href="#查询已定义的template" aria-hidden="true">#</a> <strong>查询已定义的template</strong></h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET _scripts/test\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="/images/elasticsearch/image-20211113053437221.png" alt=""></p><h2 id="删除已定义的template" tabindex="-1"><a class="header-anchor" href="#删除已定义的template" aria-hidden="true">#</a> 删除已定义的template</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>DELETE _scripts/test\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>',23),p={},t=(0,a(66262).A)(p,[["render",function(n,s){return e}]])},66262:(n,s)=>{s.A=(n,s)=>{const a=n.__vccOpts||n;for(const[n,e]of s)a[n]=e;return a}}}]);
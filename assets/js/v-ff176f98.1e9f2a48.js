"use strict";(self.webpackChunkq10viking_github_io=self.webpackChunkq10viking_github_io||[]).push([[4763],{26781:(n,s,a)=>{a.r(s),a.d(s,{data:()=>p});const p={key:"v-ff176f98",path:"/springsecurity/07%20oauth2%E4%BA%AC%E4%B8%9C%E5%BE%AE%E4%BF%A1%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html",title:"",lang:"zh-CN",frontmatter:{sidebarDepth:3,sidebar:"auto",prev:{text:"Back To 目录",link:"/springsecurity/"},"typora-root-url":"..\\.vuepress\\public"},excerpt:"",headers:[{level:2,title:"京东微信登录（授权码模式）",slug:"京东微信登录-授权码模式",children:[]},{level:2,title:"问题",slug:"问题",children:[]}],filePathRelative:"springsecurity/07 oauth2京东微信流程分析.md"}},52189:(n,s,a)=>{a.r(s),a.d(s,{default:()=>r});var p=a(20641);const e=(0,p.Lk)("h2",{id:"京东微信登录-授权码模式",tabindex:"-1"},[(0,p.Lk)("a",{class:"header-anchor",href:"#京东微信登录-授权码模式","aria-hidden":"true"},"#"),(0,p.eW)(" 京东微信登录（授权码模式）")],-1),o={href:"https://www.processon.com/view/link/5fc4a242079129329898f55d",target:"_blank",rel:"noopener noreferrer"},t=(0,p.Fv)('<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>https://open.weixin.qq.com/connect/qrconnect?\nappid=wx827225356b689e24\n&amp;state=6CE24196ED8492E89B95165D4672DBAC0FB4BCF2822A24FD9744EC18DCD6A2922329ED0CE3741EF090751FC59B01F883\n&amp;redirect_uri=https://qq.jd.com/new/wx/callback.action?view=null\n&amp;uuid=8324f6ab01524cba82bce36e940795d6\n&amp;response_type=code\n&amp;scope=snsapi_login#wechat_redirect\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>关于微信扫码页面为什么知道，用户的手机端进行了何种操作，它的前端不断发送了轮询请求。去微信服务端查询了用户操作的状态。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 不断发送这个请求</span>\nhttps<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>lp<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>qq<span class="token punctuation">.</span>com<span class="token operator">/</span>connect<span class="token operator">/</span>l<span class="token operator">/</span>qrconnect<span class="token operator">?</span>uuid<span class="token operator">=</span><span class="token number">0510</span>X1L21rfcGa14<span class="token operator">&amp;</span>last<span class="token operator">=</span><span class="token number">404</span><span class="token operator">&amp;</span>_<span class="token operator">=</span><span class="token number">1652249139352</span>\n\n<span class="token comment">// 如果没有扫码</span>\nwindow<span class="token punctuation">.</span>wx_errcode<span class="token operator">=</span><span class="token number">408</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span>wx_code<span class="token operator">=</span>&#39;&#39;<span class="token punctuation">;</span>\n<span class="token comment">// 扫码成功</span>\nwindow<span class="token punctuation">.</span>wx_errcode<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span>wx_code<span class="token operator">=</span>&#39;&#39;<span class="token punctuation">;</span>\n<span class="token comment">// 取消登录</span>\nwindow<span class="token punctuation">.</span>wx_errcode<span class="token operator">=</span><span class="token number">403</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span>wx_code<span class="token operator">=</span>&#39;&#39;<span class="token punctuation">;</span>\n<span class="token comment">// 授权登录</span>\nwindow<span class="token punctuation">.</span>wx_errcode<span class="token operator">=</span><span class="token number">405</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span>wx_code<span class="token operator">=</span>&#39;<span class="token number">071</span>vDl000X8kON13q5000PWr744vDl05&#39;<span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>qq<span class="token punctuation">.</span>jd<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token keyword">new</span><span class="token operator">/</span>wx<span class="token operator">/</span>callback<span class="token punctuation">.</span>action<span class="token operator">?</span>view<span class="token operator">=</span><span class="token keyword">null</span>\n<span class="token operator">&amp;</span>uuid<span class="token operator">=</span><span class="token number">8324f</span><span class="token number">6</span>ab01524cba82bce36e940795d6\n<span class="token operator">&amp;</span>code<span class="token operator">=</span><span class="token number">031</span>Hez000ZBUNN1ERi000GzXDT0Hez0v    <span class="token comment">// 京东就可拿到这个微信传回来的code去访问用户微信的资源</span>\n<span class="token operator">&amp;</span>state<span class="token operator">=</span><span class="token number">6</span><span class="token constant">CE24196ED8492E89B95165D4672DBAC0FB4BCF2822A24FD9744EC18DCD6A2922329ED0CE3741EF090751FC59B01F883</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="问题" tabindex="-1"><a class="header-anchor" href="#问题" aria-hidden="true">#</a> 问题</h2><p>我手机上点击登录之后，浏览器是怎么知道我点击了？然后自动跳转到京东页面的？触发时机是什么？</p><p><img src="/images/springsecurity/image-20220511144256729.png" alt="image-20220511144256729"></p><p>回调地址：redirect_uri=https://qq.jd.com/new/wx/callback.action?view=null</p><p><strong>后端回调地址的使用</strong></p><p>微信后端会回调京东后台服务的这个接口。此时京东服务器就能拿到code，得到了用户的授权，从微信服务器中获取到用户的资料</p><p><strong>前端回调地址的使用</strong></p><p>微信服务器和京东服务器的交互，对用户来说是完全透明的。那么用户浏览器的交互怎么处理呢？经过分析，在用户停留在扫码页面时的阶段，该页面不断发送了请求，查询用户在微信服务端的操作状态。当收到微信服务端传回来的wx_errcode，前端进行相应的处理。如果时405，那么浏览器将会使用回调地址，跳转到京东的页面。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 不断发送这个请求</span>\nhttps<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>lp<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>qq<span class="token punctuation">.</span>com<span class="token operator">/</span>connect<span class="token operator">/</span>l<span class="token operator">/</span>qrconnect<span class="token operator">?</span>uuid<span class="token operator">=</span><span class="token number">0510</span>X1L21rfcGa14<span class="token operator">&amp;</span>last<span class="token operator">=</span><span class="token number">404</span><span class="token operator">&amp;</span>_<span class="token operator">=</span><span class="token number">1652249139352</span>\n<span class="token comment">// 如果没有扫码</span>\nwindow<span class="token punctuation">.</span>wx_errcode<span class="token operator">=</span><span class="token number">408</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span>wx_code<span class="token operator">=</span>&#39;&#39;<span class="token punctuation">;</span>\n<span class="token comment">// 扫码成功</span>\nwindow<span class="token punctuation">.</span>wx_errcode<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span>wx_code<span class="token operator">=</span>&#39;&#39;<span class="token punctuation">;</span>\n<span class="token comment">// 取消登录</span>\nwindow<span class="token punctuation">.</span>wx_errcode<span class="token operator">=</span><span class="token number">403</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span>wx_code<span class="token operator">=</span>&#39;&#39;<span class="token punctuation">;</span>\n<span class="token comment">// 授权登录</span>\nwindow<span class="token punctuation">.</span>wx_errcode<span class="token operator">=</span><span class="token number">405</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span>wx_code<span class="token operator">=</span>&#39;<span class="token number">071</span>vDl000X8kON13q5000PWr744vDl05&#39;<span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div>',13),c={},r=(0,a(66262).A)(c,[["render",function(n,s){const a=(0,p.g2)("OutboundLink");return(0,p.uX)(),(0,p.CE)(p.FK,null,[e,(0,p.Lk)("p",null,[(0,p.Lk)("a",o,[(0,p.eW)("OAuth2 京东登录流程"),(0,p.bF)(a)])]),t],64)}]])},66262:(n,s)=>{s.A=(n,s)=>{const a=n.__vccOpts||n;for(const[n,p]of s)a[n]=p;return a}}}]);
"use strict";(self.webpackChunkq10viking_github_io=self.webpackChunkq10viking_github_io||[]).push([[43793],{34542:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-4ae2799f",path:"/netty/03%20NIO.html",title:"",lang:"zh-CN",frontmatter:{sidebarDepth:3,sidebar:"auto",prev:{text:"Back To 目录",link:"/netty/"},"typora-root-url":"..\\.vuepress\\public"},excerpt:"",headers:[{level:2,title:"NIO与BIO的主要区别",slug:"nio与bio的主要区别",children:[{level:3,title:"面向流和面向缓冲区",slug:"面向流和面向缓冲区",children:[]},{level:3,title:"阻塞与非阻塞IO",slug:"阻塞与非阻塞io",children:[]}]},{level:2,title:"NIO之Reactor",slug:"nio之reactor",children:[]},{level:2,title:"NIO三大组件",slug:"nio三大组件",children:[{level:3,title:"Selector",slug:"selector",children:[]},{level:3,title:"Channel",slug:"channel",children:[]},{level:3,title:"Buffer",slug:"buffer",children:[]}]},{level:2,title:"NIO实现",slug:"nio实现",children:[]},{level:2,title:"SelectionKey",slug:"selectionkey",children:[{level:3,title:"SelectionKey类型和就绪条件",slug:"selectionkey类型和就绪条件",children:[]},{level:3,title:"服务端与客户端感兴趣的事件",slug:"服务端与客户端感兴趣的事件",children:[]}]},{level:2,title:"selector.wakeup",slug:"selector-wakeup",children:[]}],filePathRelative:"netty/03 NIO.md"}},66366:(n,s,a)=>{a.r(s),a.d(s,{default:()=>b});var e=a(20641);const t=(0,e.Fv)('<div class="custom-container tip"><p class="custom-container-title">TIP</p><p>NIO 库是在 JDK 1.4 中引入的。NIO 弥补了原来的 BIO 的不足，它在标准 Java 代码中提供了高速的、面向块的 I/O。NIO被称为 no-blocking io 或者 new io都说得通</p></div><h2 id="nio与bio的主要区别" tabindex="-1"><a class="header-anchor" href="#nio与bio的主要区别" aria-hidden="true">#</a> NIO与BIO的主要区别</h2><h3 id="面向流和面向缓冲区" tabindex="-1"><a class="header-anchor" href="#面向流和面向缓冲区" aria-hidden="true">#</a> 面向流和面向缓冲区</h3><p>Java NIO和IO之间第一个最大的区别是，IO是面向流的，NIO是面向缓冲区的。 Java IO面向流意味着每次从流中读一个或多个字节，直至读取所有字节，它们没有被缓存在任何地方。此外，它不能前后移动流中的数据。如果需要前后移动从流中读取的数据，需要先将它缓存到一个缓冲区。 Java NIO的缓冲导向方法略有不同。数据读取到一个它稍后处理的缓冲区，需要时可在缓冲区中前后移动。这就增加了处理过程中的灵活性。但是，还需要检查是否该缓冲区中包含所有需要处理的数据。而且，需确保当更多的数据读入缓冲区时，不要覆盖缓冲区里尚未处理的数据</p><h3 id="阻塞与非阻塞io" tabindex="-1"><a class="header-anchor" href="#阻塞与非阻塞io" aria-hidden="true">#</a> <strong>阻塞与非阻塞IO</strong></h3><p>Java IO的各种流是阻塞的。这意味着，当一个线程调用read() 或 write()时，该线程被阻塞，直到有一些数据被读取，或数据完全写入。该线程在此期间不能再干任何事情了。</p><p>Java NIO的非阻塞模式，使一个线程从某通道发送请求读取数据，但是它仅能得到目前可用的数据，如果目前没有数据可用时，就什么都不会获取。而不是保持线程阻塞，所以直至数据变的可以读取之前，该线程可以继续做其他的事情。 非阻塞写也是如此。一个线程请求写入一些数据到某通道，但不需要等待它完全写入，这个线程同时可以去做别的事情。 线程通常将非阻塞IO的空闲时间用于在其它通道上执行IO操作，所以一个单独的线程现在可以管理多个输入和输出通道（channel）。</p><h2 id="nio之reactor" tabindex="-1"><a class="header-anchor" href="#nio之reactor" aria-hidden="true">#</a> NIO之Reactor</h2><p>“反应”即“倒置”，“控制逆转”,具体事件处理程序不调用反应器，而向反应器注册一个事件处理器，表示自己对某些事件感兴趣，有时间来了，具体事件处理程序通过事件处理器对某个指定的事件发生做出反应</p><blockquote><p>路人甲就是具体事件处理程序，大堂经理就是所谓的反应器</p></blockquote><p><img src="/images/netty/10071.png" alt="https://note.youdao.com/yws/public/resource/8ef33654f746921ad769ad9fe91a4c8f/xmlnote/OFFICE6710DCE147214EFCB60F0E475BBF7B3B/10071"></p><h2 id="nio三大组件" tabindex="-1"><a class="header-anchor" href="#nio三大组件" aria-hidden="true">#</a> NIO三大组件</h2><blockquote><ol><li>Selector</li><li>Channel</li><li>Buffer</li></ol></blockquote><h3 id="selector" tabindex="-1"><a class="header-anchor" href="#selector" aria-hidden="true">#</a> Selector</h3><p>Java NIO的选择器允许一个单独的线程来监视多个输入通道，你可以注册多个通道使用一个选择器(Selectors)，然后使用一个单独的线程来操作这个选择器，进而“选择”通道：这些通道里已经有可以处理的输入，或者选择已准备写入的通道。这种选择机制，使得一个单独的线程很容易来管理多个通道。</p><p>应用程序将向Selector对象注册需要它关注的Channel，以及具体的某一个Channel会对哪些IO事件感兴趣。Selector中也会维护一个“已经注册的Channel”的容器。</p><h3 id="channel" tabindex="-1"><a class="header-anchor" href="#channel" aria-hidden="true">#</a> Channel</h3><p>通道，被建立的一个应用程序和操作系统交互事件、传递内容的渠道（注意是连接到操作系统）。那么既然是和操作系统进行内容的传递，那么说明应用程序可以通过通道读取数据，也可以通过通道向操作系统写数据，而且可以同时进行读写。</p><ul><li>所有被Selector（选择器）注册的通道，只能是继承了SelectableChannel类的子类。</li><li>ServerSocketChannel：应用服务器程序的监听通道。只有通过这个通道，应用程序才能向操作系统注册支持“多路复用IO”的端口监听。同时支持UDP协议和TCP协议。</li><li>ScoketChannel：TCP Socket套接字的监听通道，一个Socket套接字对应了一个客户端IP：端口 到 服务器IP：端口的通信连接。</li></ul><p>通道中的数据总是要先读到一个Buffer，或者总是要从一个Buffer中写入。</p><h3 id="buffer" tabindex="-1"><a class="header-anchor" href="#buffer" aria-hidden="true">#</a> Buffer</h3><p>JDK NIO是面向缓冲的。Buffer就是这个缓冲，用于和NIO通道进行交互。数据是从通道读入缓冲区，从缓冲区写入到通道中的。以写为例，应用程序都是将数据写入缓冲，再通过通道把缓冲的数据发送出去，读也是一样，数据总是先从通道读到缓冲，应用程序再读缓冲的数据。</p><p>缓冲区本质上是一块可以写入数据，然后可以从中读取数据的内存（其实就是数组）。这块内存被包装成NIO Buffer对象，并提供了一组方法，用来方便的访问该块内存。</p><p><img src="/images/netty/10072.png" alt="https://note.youdao.com/yws/public/resource/8ef33654f746921ad769ad9fe91a4c8f/xmlnote/OFFICEC226BF21871B4E32B06A57F9E239AD3B/10072"></p><h2 id="nio实现" tabindex="-1"><a class="header-anchor" href="#nio实现" aria-hidden="true">#</a> NIO实现</h2>',25),k={href:"https://github.com/Q10Viking/learncode/tree/main/Netty/NIO/nio",target:"_blank",rel:"noopener noreferrer"},c=(0,e.Lk)("blockquote",null,[(0,e.Lk)("p",null,"server")],-1),o=(0,e.Lk)("div",{class:"language-java ext-java line-numbers-mode"},[(0,e.Lk)("pre",{class:"language-java"},[(0,e.Lk)("code",null,[(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"class"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"NioServer"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"ServerHandler"),(0,e.eW)(" serverHandler"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"NioServer"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        serverHandler "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"ServerHandler"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token constant"},"DEFAULT_PORT"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"void"),(0,e.eW)(),(0,e.Lk)("span",{class:"token function"},"start"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"Thread"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("serverHandler"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.Lk)("span",{class:"token string"},'"Server"'),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"start"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"static"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"void"),(0,e.eW)(),(0,e.Lk)("span",{class:"token function"},"main"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"String"),(0,e.Lk)("span",{class:"token punctuation"},"["),(0,e.Lk)("span",{class:"token punctuation"},"]"),(0,e.eW)(" args"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"NioServer"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"start"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n"),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n"),(0,e.Lk)("span",{class:"token doc-comment comment"},[(0,e.eW)("/**\n * 四月 09, 2023 8:22:22 下午 org.hzz.server.ServerHandler "),(0,e.Lk)("span",{class:"token tag"},[(0,e.Lk)("span",{class:"token tag"},[(0,e.Lk)("span",{class:"token punctuation"},"<"),(0,e.eW)("init")]),(0,e.Lk)("span",{class:"token punctuation"},">")]),(0,e.eW)("\n * 信息: 服务器已启动，端口号：8080\n * 四月 09, 2023 8:22:33 下午 org.hzz.server.ServerHandler handleInput\n * 信息: 接受到新的连接：/127.0.0.1:14804\n * 四月 09, 2023 8:22:52 下午 org.hzz.server.ServerHandler handleInput\n * 信息: 接受到消息：你好\n */")]),(0,e.eW)("\n")])]),(0,e.Lk)("div",{class:"line-numbers"},[(0,e.Lk)("span",{class:"line-number"},"1"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"2"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"3"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"4"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"5"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"6"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"7"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"8"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"9"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"10"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"11"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"12"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"13"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"14"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"15"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"16"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"17"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"18"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"19"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"20"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"21"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"22"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"23"),(0,e.Lk)("br")])],-1),p=(0,e.Lk)("div",{class:"language-java ext-java line-numbers-mode"},[(0,e.Lk)("pre",{class:"language-java"},[(0,e.Lk)("code",null,[(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"class"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"ServerHandler"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"implements"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"Runnable"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"static"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"Logger"),(0,e.eW)(" logger "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"Logger"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"getLogger"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"ServerHandler"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token keyword"},"class"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"getName"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"volatile"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"boolean"),(0,e.eW)(" started"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"final"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"int"),(0,e.eW)(" port"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"Selector"),(0,e.eW)(" selector"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"ServerSocketChannel"),(0,e.eW)(" serverSocketChannel"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"ServerHandler"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token keyword"},"int"),(0,e.eW)(" port"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"this"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.eW)("port "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(" port"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"try"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token comment"},"/*创建选择器的实例*/"),(0,e.eW)("\n            selector "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"Selector"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token keyword"},"open"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token comment"},"/*创建ServerSocketChannel的实例*/"),(0,e.eW)("\n            serverSocketChannel "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"ServerSocketChannel"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token keyword"},"open"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token comment"},"/*设置通道为非阻塞模式*/"),(0,e.eW)("\n            serverSocketChannel"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"configureBlocking"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token boolean"},"false"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token comment"},"/*绑定端口*/"),(0,e.eW)("\n            serverSocketChannel"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"socket"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"bind"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"InetSocketAddress"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("port"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token comment"},"/*注册事件，表示关心客户端连接*/"),(0,e.eW)("\n            serverSocketChannel"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"register"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("selector"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"SelectionKey"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token constant"},"OP_ACCEPT"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            logger"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"info"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token string"},'"服务器已启动，端口号："'),(0,e.eW)(),(0,e.Lk)("span",{class:"token operator"},"+"),(0,e.eW)(" port"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            started "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token boolean"},"true"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"catch"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"IOException"),(0,e.eW)(" e"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token keyword"},"throw"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"RuntimeException"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("e"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token annotation punctuation"},"@Override"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"void"),(0,e.eW)(),(0,e.Lk)("span",{class:"token function"},"run"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"while"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("started"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token keyword"},"try"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token comment"},"/*阻塞等待就绪的Channel*/"),(0,e.eW)("\n                selector"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"select"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token comment"},"/*获取事件的集合*/"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token class-name"},"Set"),(0,e.Lk)("span",{class:"token generics"},[(0,e.Lk)("span",{class:"token punctuation"},"<"),(0,e.Lk)("span",{class:"token class-name"},"SelectionKey"),(0,e.Lk)("span",{class:"token punctuation"},">")]),(0,e.eW)(" selectionKeys "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(" selector"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"selectedKeys"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token class-name"},"Iterator"),(0,e.Lk)("span",{class:"token generics"},[(0,e.Lk)("span",{class:"token punctuation"},"<"),(0,e.Lk)("span",{class:"token class-name"},"SelectionKey"),(0,e.Lk)("span",{class:"token punctuation"},">")]),(0,e.eW)(" iterator "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(" selectionKeys"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"iterator"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token keyword"},"while"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("iterator"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"hasNext"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token class-name"},"SelectionKey"),(0,e.eW)(" key "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(" iterator"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"next"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    iterator"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"remove"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token comment"},"/*处理事件*/"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token keyword"},"try"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                        "),(0,e.Lk)("span",{class:"token function"},"handleInput"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("key"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"catch"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"Exception"),(0,e.eW)(" e"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                        "),(0,e.Lk)("span",{class:"token keyword"},"if"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("key "),(0,e.Lk)("span",{class:"token operator"},"!="),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"null"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                            "),(0,e.Lk)("span",{class:"token comment"},"/*取消特定的注册关系*/"),(0,e.eW)("\n                            key"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"cancel"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                            "),(0,e.Lk)("span",{class:"token keyword"},"if"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("key"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"channel"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token operator"},"!="),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"null"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                                key"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"channel"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"close"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                            "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n                        "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"catch"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"IOException"),(0,e.eW)(" e"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token keyword"},"throw"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"RuntimeException"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("e"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"void"),(0,e.eW)(),(0,e.Lk)("span",{class:"token function"},"handleInput"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"SelectionKey"),(0,e.eW)(" key"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"throws"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"IOException"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"if"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("key"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"isValid"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token comment"},"/*处理新接入的请求消息*/"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token keyword"},"if"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("key"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"isAcceptable"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token comment"},"/*获取关心当前事件的Channel*/"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token class-name"},"ServerSocketChannel"),(0,e.eW)(" ssc "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"ServerSocketChannel"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(" key"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"channel"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token comment"},"/*接受连接*/"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token class-name"},"SocketChannel"),(0,e.eW)(" sc "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(" ssc"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"accept"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                logger"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"info"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token string"},'"接受到新的连接："'),(0,e.eW)(),(0,e.Lk)("span",{class:"token operator"},"+"),(0,e.eW)(" sc"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"getRemoteAddress"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token comment"},"/*设置为非阻塞模式*/"),(0,e.eW)("\n                sc"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"configureBlocking"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token boolean"},"false"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token comment"},"/*注册读事件*/"),(0,e.eW)("\n                sc"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"register"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("selector"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"SelectionKey"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token constant"},"OP_READ"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token comment"},"/*读消息*/"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token keyword"},"if"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("key"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"isReadable"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token class-name"},"SocketChannel"),(0,e.eW)(" sc "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"SocketChannel"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(" key"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"channel"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token comment"},"/*创建ByteBuffer，开辟一个缓冲区*/"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token class-name"},"ByteBuffer"),(0,e.eW)(" buffer "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"ByteBuffer"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"allocate"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token number"},"1024"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token keyword"},"int"),(0,e.eW)(" readBytes "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(" sc"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"read"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("buffer"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token keyword"},"if"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("readBytes "),(0,e.Lk)("span",{class:"token operator"},">"),(0,e.eW)(),(0,e.Lk)("span",{class:"token number"},"0"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token comment"},"/*将缓冲区当前的limit设置为position=0，用于后续对缓冲区的读取操作*/"),(0,e.eW)("\n                    buffer"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"flip"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token comment"},"/*根据缓冲区可读字节数创建字节数组*/"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token keyword"},"byte"),(0,e.Lk)("span",{class:"token punctuation"},"["),(0,e.Lk)("span",{class:"token punctuation"},"]"),(0,e.eW)(" bytes "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"byte"),(0,e.Lk)("span",{class:"token punctuation"},"["),(0,e.eW)("buffer"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"remaining"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},"]"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token comment"},"/*将缓冲区可读字节数组复制到新建的数组中*/"),(0,e.eW)("\n                    buffer"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"get"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("bytes"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token class-name"},"String"),(0,e.eW)(" msg "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"String"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("bytes"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.eW)(),(0,e.Lk)("span",{class:"token string"},'"UTF-8"'),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    logger"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"info"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token string"},'"接受到消息："'),(0,e.eW)(),(0,e.Lk)("span",{class:"token operator"},"+"),(0,e.eW)(" msg"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token comment"},"/*回复消息*/"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token class-name"},"String"),(0,e.eW)(" response "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token string"},'"Hello,"'),(0,e.eW)(),(0,e.Lk)("span",{class:"token operator"},"+"),(0,e.eW)(" msg "),(0,e.Lk)("span",{class:"token operator"},"+"),(0,e.eW)(),(0,e.Lk)("span",{class:"token string"},'",Now is "'),(0,e.eW)(),(0,e.Lk)("span",{class:"token operator"},"+"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"LocalDateTime"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"now"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token function"},"doWrite"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("sc"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.eW)(" response"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"void"),(0,e.eW)(),(0,e.Lk)("span",{class:"token function"},"doWrite"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"SocketChannel"),(0,e.eW)(" channel"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"String"),(0,e.eW)(" response"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"throws"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"IOException"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token comment"},"/*将消息编码为字节数组*/"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"byte"),(0,e.Lk)("span",{class:"token punctuation"},"["),(0,e.Lk)("span",{class:"token punctuation"},"]"),(0,e.eW)(" bytes "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(" response"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"getBytes"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token comment"},"/*根据数组容量创建ByteBuffer*/"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token class-name"},"ByteBuffer"),(0,e.eW)(" writeBuffer "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"ByteBuffer"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"allocate"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("bytes"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.eW)("length"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token comment"},"/*将字节数组复制到缓冲区*/"),(0,e.eW)("\n        writeBuffer"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"put"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("bytes"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token comment"},"/*flip操作*/"),(0,e.eW)("\n        writeBuffer"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"flip"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token comment"},"/*发送缓冲区的字节数组*/"),(0,e.eW)("\n        channel"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"write"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("writeBuffer"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"void"),(0,e.eW)(),(0,e.Lk)("span",{class:"token function"},"stop"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        started "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token boolean"},"false"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n"),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n")])]),(0,e.Lk)("div",{class:"line-numbers"},[(0,e.Lk)("span",{class:"line-number"},"1"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"2"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"3"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"4"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"5"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"6"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"7"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"8"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"9"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"10"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"11"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"12"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"13"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"14"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"15"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"16"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"17"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"18"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"19"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"20"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"21"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"22"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"23"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"24"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"25"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"26"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"27"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"28"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"29"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"30"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"31"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"32"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"33"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"34"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"35"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"36"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"37"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"38"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"39"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"40"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"41"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"42"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"43"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"44"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"45"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"46"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"47"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"48"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"49"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"50"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"51"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"52"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"53"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"54"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"55"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"56"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"57"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"58"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"59"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"60"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"61"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"62"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"63"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"64"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"65"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"66"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"67"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"68"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"69"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"70"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"71"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"72"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"73"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"74"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"75"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"76"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"77"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"78"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"79"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"80"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"81"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"82"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"83"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"84"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"85"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"86"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"87"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"88"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"89"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"90"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"91"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"92"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"93"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"94"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"95"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"96"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"97"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"98"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"99"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"100"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"101"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"102"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"103"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"104"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"105"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"106"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"107"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"108"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"109"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"110"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"111"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"112"),(0,e.Lk)("br")])],-1),l=(0,e.Lk)("blockquote",null,[(0,e.Lk)("p",null,"客户端")],-1),u=(0,e.Lk)("div",{class:"language-java ext-java line-numbers-mode"},[(0,e.Lk)("pre",{class:"language-java"},[(0,e.Lk)("code",null,[(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"class"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"NioClient"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"ClientHandler"),(0,e.eW)(" clientHandler"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"NioClient"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        clientHandler "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"ClientHandler"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token constant"},"DEFAULT_SERVER_IP"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.Lk)("span",{class:"token constant"},"DEFAULT_PORT"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"void"),(0,e.eW)(),(0,e.Lk)("span",{class:"token function"},"start"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"Thread"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("clientHandler"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.Lk)("span",{class:"token string"},'"Client"'),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"start"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"boolean"),(0,e.eW)(),(0,e.Lk)("span",{class:"token function"},"sendMsg"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"String"),(0,e.eW)(" msg"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"return"),(0,e.eW)(" clientHandler"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"sendMsg"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("msg"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"static"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"void"),(0,e.eW)(),(0,e.Lk)("span",{class:"token function"},"main"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"String"),(0,e.Lk)("span",{class:"token punctuation"},"["),(0,e.Lk)("span",{class:"token punctuation"},"]"),(0,e.eW)(" args"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"throws"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"IOException"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token class-name"},"NioClient"),(0,e.eW)(" nioClient "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"NioClient"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        nioClient"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"start"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token class-name"},"Scanner"),(0,e.eW)(" scanner "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"Scanner"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"System"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.eW)("in"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"while"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("nioClient"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"sendMsg"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("scanner"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"nextLine"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n"),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n"),(0,e.Lk)("span",{class:"token doc-comment comment"},"/**\n * 四月 09, 2023 8:22:33 下午 org.hzz.client.ClientHandler doConnect\n * 信息: doConnect 连接失败 注册OP_CONNECT\n * 四月 09, 2023 8:22:33 下午 org.hzz.client.ClientHandler handleInput\n * 信息: handleInput 连接成功\n * 四月 09, 2023 8:22:33 下午 org.hzz.client.ClientHandler handleInput\n * 信息: true\n * 你好\n * 四月 09, 2023 8:22:52 下午 org.hzz.client.ClientHandler doWrite\n * 信息: 客户端发送消息成功：你好\n * 四月 09, 2023 8:22:52 下午 org.hzz.client.ClientHandler handleInput\n * 信息: 客户端收到消息：Hello,你好,Now is 2023-04-09T20:22:52.181\n */"),(0,e.eW)("\n")])]),(0,e.Lk)("div",{class:"line-numbers"},[(0,e.Lk)("span",{class:"line-number"},"1"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"2"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"3"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"4"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"5"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"6"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"7"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"8"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"9"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"10"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"11"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"12"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"13"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"14"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"15"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"16"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"17"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"18"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"19"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"20"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"21"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"22"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"23"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"24"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"25"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"26"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"27"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"28"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"29"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"30"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"31"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"32"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"33"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"34"),(0,e.Lk)("br")])],-1),L=(0,e.Lk)("div",{class:"language-java ext-java line-numbers-mode"},[(0,e.Lk)("pre",{class:"language-java"},[(0,e.Lk)("code",null,[(0,e.eW)("\n"),(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"class"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"ClientHandler"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"implements"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"Runnable"),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"static"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"Logger"),(0,e.eW)(" logger "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"Logger"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"getLogger"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"ClientHandler"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token keyword"},"class"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"getName"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"final"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"String"),(0,e.eW)(" ip"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"final"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"int"),(0,e.eW)(" port"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"Selector"),(0,e.eW)(" selector"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"SocketChannel"),(0,e.eW)(" socketChannel"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"volatile"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"boolean"),(0,e.eW)(" started"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"ClientHandler"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"String"),(0,e.eW)(" ip"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"int"),(0,e.eW)(" port"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"this"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.eW)("ip "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(" ip"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"this"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.eW)("port "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(" port"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"try"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n            selector "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"Selector"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token keyword"},"open"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            socketChannel "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"SocketChannel"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token keyword"},"open"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            socketChannel"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"configureBlocking"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token boolean"},"false"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            started "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token boolean"},"true"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"catch"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"IOException"),(0,e.eW)(" e"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token keyword"},"throw"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"RuntimeException"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("e"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token annotation punctuation"},"@Override"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"void"),(0,e.eW)(),(0,e.Lk)("span",{class:"token function"},"run"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token function"},"doConnect"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n\n        "),(0,e.Lk)("span",{class:"token keyword"},"while"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("started"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token keyword"},"try"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                selector"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"select"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token class-name"},"Set"),(0,e.Lk)("span",{class:"token generics"},[(0,e.Lk)("span",{class:"token punctuation"},"<"),(0,e.Lk)("span",{class:"token class-name"},"SelectionKey"),(0,e.Lk)("span",{class:"token punctuation"},">")]),(0,e.eW)(" selectionKeys "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(" selector"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"selectedKeys"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token class-name"},"Iterator"),(0,e.Lk)("span",{class:"token generics"},[(0,e.Lk)("span",{class:"token punctuation"},"<"),(0,e.Lk)("span",{class:"token class-name"},"SelectionKey"),(0,e.Lk)("span",{class:"token punctuation"},">")]),(0,e.eW)(" iterator "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(" selectionKeys"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"iterator"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token keyword"},"while"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("iterator"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"hasNext"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token class-name"},"SelectionKey"),(0,e.eW)(" key "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(" iterator"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"next"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token comment"},"/*我们必须首先将处理过的 SelectionKey 从选定的键集合中删除。\n                    如果我们没有删除处理过的键，那么它仍然会在主集合中以一个激活\n                    的键出现，这会导致我们尝试再次处理它。*/"),(0,e.eW)("\n                    iterator"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"remove"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token function"},"handleInput"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("key"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"catch"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"IOException"),(0,e.eW)(" e"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token keyword"},"throw"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"RuntimeException"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("e"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"void"),(0,e.eW)(),(0,e.Lk)("span",{class:"token function"},"handleInput"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"SelectionKey"),(0,e.eW)(" key"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"throws"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"IOException"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"if"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("key"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"isValid"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token class-name"},"SocketChannel"),(0,e.eW)(" sc "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"SocketChannel"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(" key"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"channel"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token keyword"},"if"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("key"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"isConnectable"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token keyword"},"if"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("sc"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"finishConnect"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token comment"},"//TODO"),(0,e.eW)("\n                    logger"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"info"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token string"},'"handleInput 连接成功"'),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    logger"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"info"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"String"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"valueOf"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("sc "),(0,e.Lk)("span",{class:"token operator"},"=="),(0,e.eW)(" socketChannel"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    sc"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"register"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("selector"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"SelectionKey"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token constant"},"OP_READ"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.Lk)("span",{class:"token keyword"},"else"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token class-name"},"System"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"exit"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token number"},"1"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"else"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"if"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("key"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"isReadable"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token class-name"},"ByteBuffer"),(0,e.eW)(" readBuffer "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"ByteBuffer"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"allocate"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token number"},"1024"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token keyword"},"int"),(0,e.eW)(" readBytes "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(" sc"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"read"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("readBuffer"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token keyword"},"if"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("readBytes "),(0,e.Lk)("span",{class:"token operator"},">"),(0,e.eW)(),(0,e.Lk)("span",{class:"token number"},"0"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                    readBuffer"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"flip"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token keyword"},"byte"),(0,e.Lk)("span",{class:"token punctuation"},"["),(0,e.Lk)("span",{class:"token punctuation"},"]"),(0,e.eW)(" bytes "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"byte"),(0,e.Lk)("span",{class:"token punctuation"},"["),(0,e.eW)("readBuffer"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"remaining"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},"]"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    readBuffer"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"get"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("bytes"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token class-name"},"String"),(0,e.eW)(" body "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"String"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("bytes"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.eW)(),(0,e.Lk)("span",{class:"token string"},'"UTF-8"'),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    logger"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"info"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token string"},'"客户端收到消息："'),(0,e.eW)(),(0,e.Lk)("span",{class:"token operator"},"+"),(0,e.eW)(" body"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"else"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"if"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("readBytes "),(0,e.Lk)("span",{class:"token operator"},"<"),(0,e.eW)(),(0,e.Lk)("span",{class:"token number"},"0"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                    key"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"cancel"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                    sc"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"close"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"else"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                    "),(0,e.Lk)("span",{class:"token comment"},"//读到0字节，忽略"),(0,e.eW)("\n                "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"void"),(0,e.eW)(),(0,e.Lk)("span",{class:"token function"},"doConnect"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"try"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token keyword"},"if"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("socketChannel"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"connect"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"InetSocketAddress"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("ip"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.eW)(" port"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                logger"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"info"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token string"},'"doConnect 连接成功"'),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                socketChannel"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"register"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("selector"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"SelectionKey"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token constant"},"OP_READ"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"else"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n                logger"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"info"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token string"},'"doConnect 连接失败 注册OP_CONNECT"'),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n                socketChannel"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"register"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("selector"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"SelectionKey"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token constant"},"OP_CONNECT"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"catch"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"IOException"),(0,e.eW)(" e"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token keyword"},"throw"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"new"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"RuntimeException"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("e"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token keyword"},"private"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"void"),(0,e.eW)(),(0,e.Lk)("span",{class:"token function"},"doWrite"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"SocketChannel"),(0,e.eW)(" channel"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"String"),(0,e.eW)(" request"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"throws"),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"IOException"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"byte"),(0,e.Lk)("span",{class:"token punctuation"},"["),(0,e.Lk)("span",{class:"token punctuation"},"]"),(0,e.eW)(" bytes "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(" request"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"getBytes"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token class-name"},"ByteBuffer"),(0,e.eW)(" writeBuffer "),(0,e.Lk)("span",{class:"token operator"},"="),(0,e.eW)(),(0,e.Lk)("span",{class:"token class-name"},"ByteBuffer"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"allocate"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("bytes"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.eW)("length"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        writeBuffer"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"put"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("bytes"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        writeBuffer"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"flip"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        channel"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"write"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("writeBuffer"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"if"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token operator"},"!"),(0,e.eW)("writeBuffer"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"hasRemaining"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n            logger"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"info"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token string"},'"客户端发送消息成功："'),(0,e.eW)(),(0,e.Lk)("span",{class:"token operator"},"+"),(0,e.eW)(" request"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n\n    "),(0,e.Lk)("span",{class:"token comment"},"//写数据对外暴露的API"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token keyword"},"public"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"boolean"),(0,e.eW)(),(0,e.Lk)("span",{class:"token function"},"sendMsg"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"String"),(0,e.eW)(" msg"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)("  "),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token keyword"},"try"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token function"},"doWrite"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.eW)("socketChannel"),(0,e.Lk)("span",{class:"token punctuation"},","),(0,e.eW)("msg"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token keyword"},"return"),(0,e.eW)(),(0,e.Lk)("span",{class:"token boolean"},"true"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)(),(0,e.Lk)("span",{class:"token keyword"},"catch"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token class-name"},"IOException"),(0,e.eW)(" e"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.eW)(),(0,e.Lk)("span",{class:"token punctuation"},"{"),(0,e.eW)("\n            logger"),(0,e.Lk)("span",{class:"token punctuation"},"."),(0,e.Lk)("span",{class:"token function"},"info"),(0,e.Lk)("span",{class:"token punctuation"},"("),(0,e.Lk)("span",{class:"token string"},'"客户端发送消息失败："'),(0,e.eW)(),(0,e.Lk)("span",{class:"token operator"},"+"),(0,e.eW)(" msg"),(0,e.Lk)("span",{class:"token punctuation"},")"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n            "),(0,e.Lk)("span",{class:"token keyword"},"return"),(0,e.eW)(),(0,e.Lk)("span",{class:"token boolean"},"false"),(0,e.Lk)("span",{class:"token punctuation"},";"),(0,e.eW)("\n        "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n    "),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n"),(0,e.Lk)("span",{class:"token punctuation"},"}"),(0,e.eW)("\n\n")])]),(0,e.Lk)("div",{class:"line-numbers"},[(0,e.Lk)("span",{class:"line-number"},"1"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"2"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"3"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"4"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"5"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"6"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"7"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"8"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"9"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"10"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"11"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"12"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"13"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"14"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"15"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"16"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"17"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"18"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"19"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"20"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"21"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"22"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"23"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"24"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"25"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"26"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"27"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"28"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"29"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"30"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"31"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"32"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"33"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"34"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"35"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"36"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"37"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"38"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"39"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"40"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"41"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"42"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"43"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"44"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"45"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"46"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"47"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"48"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"49"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"50"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"51"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"52"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"53"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"54"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"55"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"56"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"57"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"58"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"59"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"60"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"61"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"62"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"63"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"64"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"65"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"66"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"67"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"68"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"69"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"70"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"71"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"72"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"73"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"74"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"75"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"76"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"77"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"78"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"79"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"80"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"81"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"82"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"83"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"84"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"85"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"86"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"87"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"88"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"89"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"90"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"91"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"92"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"93"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"94"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"95"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"96"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"97"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"98"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"99"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"100"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"101"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"102"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"103"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"104"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"105"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"106"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"107"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"108"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"109"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"110"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"111"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"112"),(0,e.Lk)("br"),(0,e.Lk)("span",{class:"line-number"},"113"),(0,e.Lk)("br")])],-1),i=(0,e.Fv)('<h2 id="selectionkey" tabindex="-1"><a class="header-anchor" href="#selectionkey" aria-hidden="true">#</a> SelectionKey</h2><p>SelectionKey是一个抽象类,表示selectableChannel在Selector中注册的标识.每个Channel向Selector注册时,都将会创建一个SelectionKey。SelectionKey将Channel与Selector建立了关系，并维护了channel事件。</p><p>可以通过cancel方法取消键,取消的键不会立即从selector中移除,而是添加到cancelledKeys中,在下一次select操作时移除它.所以在调用某个key时,需要使用isValid进行校验.</p><h3 id="selectionkey类型和就绪条件" tabindex="-1"><a class="header-anchor" href="#selectionkey类型和就绪条件" aria-hidden="true">#</a> <strong>SelectionKey类型和就绪条件</strong></h3><table><thead><tr><th><strong>操作类型</strong></th><th><strong>就绪条件及说明</strong></th></tr></thead><tbody><tr><td>OP_READ</td><td>当操作系统读缓冲区有数据可读时就绪。并非时刻都有数据可读，所以一般需要注册该操作，仅当有就绪时才发起读操作，有的放矢，避免浪费CPU。</td></tr><tr><td>OP_WRITE</td><td>当操作系统写缓冲区有空闲空间时就绪。一般情况下写缓冲区都有空闲空间，小块数据直接写入即可，没必要注册该操作类型，否则该条件不断就绪浪费CPU；但如果是写密集型的任务，比如文件下载等，缓冲区很可能满，注册该操作类型就很有必要，同时注意写完后取消注册。</td></tr><tr><td>OP_CONNECT</td><td>当SocketChannel.connect()请求连接成功后就绪。该操作只给客户端使用。</td></tr><tr><td>OP_ACCEPT</td><td>当接收到一个客户端连接请求时就绪。该操作只给服务器使用。</td></tr></tbody></table><h3 id="服务端与客户端感兴趣的事件" tabindex="-1"><a class="header-anchor" href="#服务端与客户端感兴趣的事件" aria-hidden="true">#</a> 服务端与客户端感兴趣的事件</h3><p>ServerSocketChannel和SocketChannel可以注册自己感兴趣的操作类型，当对应操作类型的就绪条件满足时OS会通知channel，下表描述各种Channel允许注册的操作类型，Y表示允许注册，N表示不允许注册，其中服务器SocketChannel指由服务器ServerSocketChannel.accept()返回的对象。</p><table><thead><tr><th></th><th>OP_READ</th><th>OP_WRITE</th><th>OP_CONNECT</th><th>OP_ACCEPT</th></tr></thead><tbody><tr><td>服务器ServerSocketChannel</td><td></td><td></td><td></td><td><strong>Y</strong></td></tr><tr><td>服务器SocketChannel</td><td><strong>Y</strong></td><td><strong>Y</strong></td><td></td><td></td></tr><tr><td>客户端SocketChannel</td><td><strong>Y</strong></td><td><strong>Y</strong></td><td><strong>Y</strong></td><td></td></tr></tbody></table><p>服务器启动ServerSocketChannel，关注OP_ACCEPT事件，</p><p>客户端启动SocketChannel，连接服务器，关注OP_CONNECT事件</p><p>服务器接受连接，启动一个服务器的SocketChannel，这个SocketChannel可以关注OP_READ、OP_WRITE事件，一般连接建立后会直接关注OP_READ事件</p><p>客户端这边的客户端SocketChannel发现连接建立后，可以关注OP_READ、OP_WRITE事件，一般是需要客户端需要发送数据了才关注OP_READ事件</p><p>连接建立后客户端与服务器端开始相互发送消息（读写），根据实际情况来关注OP_READ、OP_WRITE事件。</p><h2 id="selector-wakeup" tabindex="-1"><a class="header-anchor" href="#selector-wakeup" aria-hidden="true">#</a> selector.wakeup</h2><blockquote><p>唤醒阻塞的selector.select()</p></blockquote>',15),r={},b=(0,a(66262).A)(r,[["render",function(n,s){const a=(0,e.g2)("OutboundLink"),r=(0,e.g2)("CodeGroupItem"),b=(0,e.g2)("CodeGroup");return(0,e.uX)(),(0,e.CE)(e.FK,null,[t,(0,e.Lk)("p",null,[(0,e.Lk)("a",k,[(0,e.eW)("Source Code"),(0,e.bF)(a)])]),c,(0,e.bF)(b,null,{default:(0,e.k6)((()=>[(0,e.bF)(r,{title:"NioServer"},{default:(0,e.k6)((()=>[o])),_:1}),(0,e.bF)(r,{title:"ServerHandler"},{default:(0,e.k6)((()=>[p])),_:1})])),_:1}),l,(0,e.bF)(b,null,{default:(0,e.k6)((()=>[(0,e.bF)(r,{title:"NioClient"},{default:(0,e.k6)((()=>[u])),_:1}),(0,e.bF)(r,{title:"ClientHandler"},{default:(0,e.k6)((()=>[L])),_:1})])),_:1}),i],64)}]])},66262:(n,s)=>{s.A=(n,s)=>{const a=n.__vccOpts||n;for(const[n,e]of s)a[n]=e;return a}}}]);
"use strict";(self.webpackChunkq10viking_github_io=self.webpackChunkq10viking_github_io||[]).push([[73385],{894:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-50cde4e7",path:"/nacos/02%20nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA.html",title:"",lang:"zh-CN",frontmatter:{sidebarDepth:3,sidebar:"auto",prev:{text:"Back To 目录",link:"/nacos/"},"typora-root-url":"..\\.vuepress\\public"},excerpt:"",headers:[{level:2,title:"nacos集群",slug:"nacos集群",children:[]},{level:2,title:"Ngnix反向代理",slug:"ngnix反向代理",children:[]}],filePathRelative:"nacos/02 nacos集群搭建.md"}},89739:(n,s,a)=>{a.r(s),a.d(s,{default:()=>p});const e=(0,a(20641).Fv)('<h2 id="nacos集群" tabindex="-1"><a class="header-anchor" href="#nacos集群" aria-hidden="true">#</a> nacos集群</h2><ol><li><p>单机搭建伪集群，复制nacos安装包，修改为nacos8849，nacos8850，nacos8851</p></li><li><p>以nacos8849为例，进入nacos8849目录</p></li><li><p>修改conf\\application.properties的配置，使用外置数据源 要使用mysql5.7+（不支持MariaDB）（包括）</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># 修改端口</span>\n<span class="token key attr-name">server.port</span><span class="token punctuation">=</span><span class="token value attr-value">8849</span>\n<span class="token comment">#使用外置mysql数据源 </span>\n<span class="token key attr-name">spring.datasource.platform</span><span class="token punctuation">=</span><span class="token value attr-value">mysql </span>\n\n<span class="token comment">### Count of DB:</span>\n<span class="token key attr-name"> db.num</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>\n\n<span class="token comment">### Connect URL of DB:</span>\n<span class="token key attr-name"> db.url.0</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://192.168.88.131:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span>\n<span class="token key attr-name"> db.user.0</span><span class="token punctuation">=</span><span class="token value attr-value">nacos</span>\n<span class="token key attr-name"> db.password.0</span><span class="token punctuation">=</span><span class="token value attr-value">nacos</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li><li><p>将conf\\cluster.conf.example改为cluster.conf,添加节点配置</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>192.168.88.131:8849\n192.168.88.131:8850\n192.168.88.131:8851\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p>创建mysql数据库,sql文件位置：conf\\nacos-mysql.sql</p></li><li><p>如果出现内存不足：修改启动脚本（bin\\startup.sh）的jvm参数</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>JAVA_OPT=&quot;${JAVA_OPT} -server -Xms512m -Xmx512m -Xmn256m -XX:MetaspaceSize=64m -XX:MaxMetaspaceSize=128m&quot;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li><li><p>查看结果</p><p><img src="/images/nacos/image-20210802133108501.png" alt="image-20210802133108501"></p></li></ol><h2 id="ngnix反向代理" tabindex="-1"><a class="header-anchor" href="#ngnix反向代理" aria-hidden="true">#</a> Ngnix反向代理</h2><p><img src="/images/nacos/16045.png" alt="img"></p><div class="language-conf ext-conf line-numbers-mode"><pre class="language-conf"><code>upstream nacoscluster {\n        server 127.0.0.1:8849;\n        server 127.0.0.1:8850;\n        server 127.0.0.1:8851;\n    }\n    server {\n        listen        8847;\n        server_name   localhost;\n        \n        location /nacos/{\n            proxy_pass http://nacoscluster/nacos/;\n        }\n    }\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>网页访问http://192.168.88.131:8848/nacos/</p><p>项目中添加则为</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.88.131<span class="token punctuation">:</span><span class="token number">8848</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>',8),l={},p=(0,a(66262).A)(l,[["render",function(n,s){return e}]])},66262:(n,s)=>{s.A=(n,s)=>{const a=n.__vccOpts||n;for(const[n,e]of s)a[n]=e;return a}}}]);
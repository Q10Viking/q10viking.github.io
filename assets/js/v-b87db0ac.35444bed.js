"use strict";(self.webpackChunkq10viking_github_io=self.webpackChunkq10viking_github_io||[]).push([[9649],{8770:(s,n,a)=>{a.r(n),a.d(n,{data:()=>e});const e={key:"v-b87db0ac",path:"/ElasticStack/03%20%E5%AE%89%E8%A3%85Elasticsearch.html",title:"",lang:"zh-CN",frontmatter:{sidebarDepth:3,sidebar:"auto",prev:{text:"Back To 目录",link:"/ElasticStack/"},"typora-root-url":"..\\.vuepress\\public"},excerpt:"",headers:[{level:2,title:"创建一个用户",slug:"创建一个用户",children:[]},{level:2,title:"修改elasticsearch.yml",slug:"修改elasticsearch-yml",children:[]},{level:2,title:"修改jvm.option",slug:"修改jvm-option",children:[]},{level:2,title:"启动elasticsearch⭐",slug:"启动elasticsearch⭐",children:[]},{level:2,title:"启动发生的错误",slug:"启动发生的错误",children:[{level:3,title:"重启elasticsearch⭐",slug:"重启elasticsearch⭐",children:[]}]},{level:2,title:"防火墙设置⭐",slug:"防火墙设置⭐",children:[]}],filePathRelative:"ElasticStack/03 安装Elasticsearch.md"}},47318:(s,n,a)=>{a.r(n),a.d(n,{default:()=>m});var e=a(20641);const p=(0,e.Lk)("h2",{id:"创建一个用户",tabindex:"-1"},[(0,e.Lk)("a",{class:"header-anchor",href:"#创建一个用户","aria-hidden":"true"},"#"),(0,e.eW)(" 创建一个用户")],-1),l={class:"custom-container tip"},t=(0,e.Lk)("p",{class:"custom-container-title"},"TIP",-1),c=(0,e.Lk)("p",null,"ES不能使用root用户来启动，必须使用普通用户来安装启动",-1),o=(0,e.Lk)("p",null,"📗我安装在了132机器上",-1),r={href:"https://www.elastic.co/downloads/past-releases/elasticsearch-7-6-1",target:"_blank",rel:"noopener noreferrer"},i=(0,e.Fv)('<p>用户为hzz,密码为Root.123456</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>先创建组, 再创建用户:\n<span class="token number">1</span>）创建 elasticsearch 用户组\n<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># groupadd elasticsearch</span>\n\t\t\n<span class="token number">2</span>）创建用户 hzz 并设置密码\n<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># useradd hzz</span>\n<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># passwd hzz</span>\n\n<span class="token number">3</span>）<span class="token comment"># 创建es文件夹，</span>\n并修改owner为hzz用户\n<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/es\n\n<span class="token number">4</span>）用户hzz 添加到 elasticsearch 用户组\n<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># usermod -G elasticsearch hzz</span>\n <span class="token comment"># 赋予用户权限，首先需要将elasticsearch的安装包进行解压， tar -zxvf elasticsearch-7.6.1-linux-x86_64.tar.gz</span>\n <span class="token comment"># 解压后的文件夹为elasticsearch-7.6.1</span>\n<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># chown -R hzz /usr/es/elasticsearch-7.6.1</span>\n\n<span class="token number">5</span>）设置sudo权限\n<span class="token comment">#为了让普通用户有更大的操作权限，我们一般都会给普通用户设置sudo权限，方便普通用户的操作</span>\n<span class="token comment">#三台机器使用root用户执行visudo命令然后为hzz用户添加权限</span>\n<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># visudo</span>\n\n<span class="token comment">#在root ALL=(ALL) ALL 一行下面</span>\n<span class="token comment">#添加hzz用户 如下:</span>\nhzz <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> ALL\n\t\t\t \n<span class="token comment">#添加成功保存后切换到hzz用户操作</span>\n\n<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># su hzz</span>\n<span class="token punctuation">[</span>hzz@haproxy es<span class="token punctuation">]</span>$\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>赋予普通用户有更大的操作权限</p><p><img src="/images/elasticsearch/image-20210501234608875.png" alt="image-20210501234608875"></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 也可以设置为sudo时不是使用密码授权</span>\nhzz <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD:ALL\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/images/elasticsearch/image-20211112021926518.png" alt="image-20211112021926518"></p><h2 id="修改elasticsearch-yml" tabindex="-1"><a class="header-anchor" href="#修改elasticsearch-yml" aria-hidden="true">#</a> <strong>修改elasticsearch.yml</strong></h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span><span class="token punctuation">)</span> 创建两个目录\n<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/es/elasticsearch-7.6.1/log\n<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/es/elasticsearch-7.6.1/data\n\n<span class="token comment"># 目录 /usr/es/elasticsearch-7.6.1/config</span>\n<span class="token builtin class-name">cd</span> /usr/es/elasticsearch-7.6.1/config\n<span class="token function">vi</span> elasticsearch.yml\n<span class="token comment"># 将注释去掉，并修改为</span>\ncluster.name: my-application\nnode.name: node-1\npath.data: /usr/es/elasticsearch-7.6.1/data\npath.logs: /usr/es/elasticsearch-7.6.1/log\nnetwork.host: <span class="token number">0.0</span>.0.0\t<span class="token comment"># 任何IP都可以进行访问我们的es服务</span>\nhttp.port: <span class="token number">9200</span>\ndiscovery.seed_hosts: <span class="token punctuation">[</span><span class="token string">&quot;服务器IP&quot;</span><span class="token punctuation">]</span> <span class="token comment"># 此处为本机的IP地址如：discovery.seed_hosts: [&quot;192.168.187.132&quot;]</span>\ncluster.initial_master_nodes: <span class="token punctuation">[</span><span class="token string">&quot;node-1&quot;</span><span class="token punctuation">]</span> <span class="token comment"># 节点名称</span>\n<span class="token comment"># 添加一下信息，表示允许跨域</span>\nbootstrap.system_call_filter: <span class="token boolean">false</span>\nbootstrap.memory_lock: <span class="token boolean">false</span>\nhttp.cors.enabled: <span class="token boolean">true</span>\nhttp.cors.allow-origin: <span class="token string">&quot;*&quot;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="修改jvm-option" tabindex="-1"><a class="header-anchor" href="#修改jvm-option" aria-hidden="true">#</a> <strong>修改jvm.option</strong></h2><p>修改jvm.option配置文件，调整jvm堆内存大小</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># /usr/es/elasticsearch-7.6.1/config/jvm.options</span>\n<span class="token comment"># 在本地的虚拟机上设为3G</span>\n<span class="token parameter variable">-Xms1g</span>\n<span class="token parameter variable">-Xmx1g</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="启动elasticsearch⭐" tabindex="-1"><a class="header-anchor" href="#启动elasticsearch⭐" aria-hidden="true">#</a> 启动elasticsearch⭐</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 不能使用root用户启动</span>\n<span class="token comment"># /usr/es/elasticsearch-7.6.1/bin</span>\n./elasticsearch <span class="token parameter variable">-d</span>\n\n<span class="token comment"># 或者</span>\n<span class="token function">nohup</span> /usr/es/elasticsearch-7.6.1/bin/elasticsearch <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>访问http://192.168.187.132:9200/，出现如下界面表示启动成功</p><p><img src="/images/elasticsearch/image-20220812183758799.png" alt="image-20220812183758799"></p><h2 id="启动发生的错误" tabindex="-1"><a class="header-anchor" href="#启动发生的错误" aria-hidden="true">#</a> 启动发生的错误</h2><p><img src="/images/elasticsearch/image-20211112025155698.png" alt="image-20211112025155698"></p><p><strong>修复错误后需要重新启动服务器</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: max <span class="token function">file</span> descriptors <span class="token punctuation">[</span><span class="token number">4096</span><span class="token punctuation">]</span> <span class="token keyword">for</span> elasticsearch process is too low, increase to at least <span class="token punctuation">[</span><span class="token number">65535</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: max virtual memory areas vm.max_map_count <span class="token punctuation">[</span><span class="token number">65530</span><span class="token punctuation">]</span> is too low, increase to at least <span class="token punctuation">[</span><span class="token number">262144</span><span class="token punctuation">]</span>\n\n<span class="token comment"># 第三个暂时没有遇到</span>\n<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>: max number of threads <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token keyword">for</span> user <span class="token punctuation">[</span>es<span class="token punctuation">]</span> likely too low, increase to at least <span class="token punctuation">[</span><span class="token number">4096</span><span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_1-普通用户打开文件的最大数限制" tabindex="-1"><a class="header-anchor" href="#_1-普通用户打开文件的最大数限制" aria-hidden="true">#</a> 1. <strong>普通用户打开文件的最大数限制</strong></h4><p>ES因为需要大量的创建索引文件，需要大量的打开系统的文件，所以我们需要解除linux系统当中打开文件最大数目的限制，不然ES启动就会抛错</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: max <span class="token function">file</span> descriptors <span class="token punctuation">[</span><span class="token number">4096</span><span class="token punctuation">]</span> <span class="token keyword">for</span> elasticsearch process is too low, increase to at least <span class="token punctuation">[</span><span class="token number">65535</span><span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>打开文件<code>sudo vi /etc/security/limits.conf</code>，添加</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>* soft nofile <span class="token number">65536</span>\n* hard nofile <span class="token number">131072</span>\n* soft nproc <span class="token number">2048</span>\n* hard nproc <span class="token number">4096</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>⭐<strong>此文件修改后需要重新登录用户，才会生效</strong>⭐</p><hr><h4 id="_2-普通用户调大虚拟内存" tabindex="-1"><a class="header-anchor" href="#_2-普通用户调大虚拟内存" aria-hidden="true">#</a> 2. <strong>普通用户调大虚拟内存</strong></h4><div class="language-scala ext-scala line-numbers-mode"><pre class="language-scala"><code>最大虚拟内存太小\n<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">:</span> max virtual memory areas vm<span class="token punctuation">.</span>max_map_count <span class="token punctuation">[</span><span class="token number">65530</span><span class="token punctuation">]</span> is too low<span class="token punctuation">,</span> increase to <span class="token namespace">at</span> least <span class="token punctuation">[</span><span class="token number">262144</span><span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>每次启动机器都手动执行下</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">vi</span> /etc/sysctl.conf\n<span class="token comment"># 追加</span>\n<span class="token assign-left variable">vm.max_map_count</span><span class="token operator">=</span><span class="token number">262144</span>\n<span class="token comment"># 保存后，执行刷新一下文件</span>\n<span class="token function">sudo</span> <span class="token function">sysctl</span> <span class="token parameter variable">-p</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_3-普通用户启动线程数限制" tabindex="-1"><a class="header-anchor" href="#_3-普通用户启动线程数限制" aria-hidden="true">#</a> 3. <strong>普通用户启动线程数限制</strong></h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>无法创建本地线程问题,用户最大可创建线程数太小\n max number of threads <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token keyword">for</span> user <span class="token punctuation">[</span>es<span class="token punctuation">]</span> likely too low, increase to at least <span class="token punctuation">[</span><span class="token number">4096</span><span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Centos6\nsudo vi /etc/security/limits.d/90-nproc.conf\nCentos7\nsudo vi /etc/security/limits.d/20-nproc.conf\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>找到如下内容进行修改</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>* soft nproc <span class="token number">1024</span><span class="token comment">#修改为</span>\n* soft nproc <span class="token number">4096</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="重启elasticsearch⭐" tabindex="-1"><a class="header-anchor" href="#重启elasticsearch⭐" aria-hidden="true">#</a> 重启elasticsearch⭐</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 找到进程号</span>\n<span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> elastic\n<span class="token comment"># 结束该进程</span>\n<span class="token function">kill</span> <span class="token parameter variable">-9</span> pid\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="防火墙设置⭐" tabindex="-1"><a class="header-anchor" href="#防火墙设置⭐" aria-hidden="true">#</a> 防火墙设置⭐</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查看是否开放端口</span>\n<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --query-port=9200/tcp</span>\nno\n\n<span class="token comment"># 需要防火墙开启该端口</span>\n<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --zone=public --add-port=9200/tcp --permanent</span>\nsuccess\n\n<span class="token comment"># 重新加载防火墙</span>\n<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --reload</span>\nsuccess\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div>',39),u={},m=(0,a(66262).A)(u,[["render",function(s,n){const a=(0,e.g2)("OutboundLink");return(0,e.uX)(),(0,e.CE)(e.FK,null,[p,(0,e.Lk)("div",l,[t,c,o,(0,e.Lk)("p",null,[(0,e.Lk)("a",r,[(0,e.eW)("下载7.6.1"),(0,e.bF)(a)])])]),i],64)}]])},66262:(s,n)=>{n.A=(s,n)=>{const a=s.__vccOpts||s;for(const[s,e]of n)a[s]=e;return a}}}]);
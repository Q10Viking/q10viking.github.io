---
sidebarDepth: 3
sidebar: auto
prev:
  text: Back To 目录
  link: /MySQL/
typora-root-url: ..\.vuepress\public
---

## 索引数据结构

**索引是帮助MySQL高效获取数据的排好序的数据结构**，作用，减少在磁盘上的查询次数

索引比喻就像目录页

- 二叉树
- 红黑树
- Hash表
- B-Tree

```sql
-- 如果没有索引就会一行一行的去寻找
select * from t where t.col2 = 89; 
```

数据表都是存储在磁盘上的，磁盘IO读取，一行行的查找，效率比较低。所以**引入索引，来控制磁盘IO查找的次数**。



## 二叉树

对于单边增长的数据，没有效果

为Col2建立索引，二叉树的key为Col2的值，value则为数据行所在的地址

这样再次查询Col2 = 89时，只需要查询两次，就可以找到该数据行

```sql
select * from t where t.col2 = 89; 
```

![image-20210519183353632](/images/MySQL/image-20210519183353632.png)

### 缺点

如果数据都是**单边递增或者单向递减**，使用二叉树建立的索引，会导致数据的深度变得非常深

![image-20211026164251738](/images/MySQL/image-20211026164251738.png)

这样如果查询Col1 = 6,那么在查询效率上并没得到提升。还是需要遍历6次

```sql
select * from t where t.col1 = 6; 
```

### 

## 红黑树

**二叉平衡树**，会**改变单边增长的效果**，

![image-20211026164550332](/images/MySQL/image-20211026164550332.png)

这样再次查找Col1 = 6的数据，则只会查找3次就可以找到了

### 缺点

随着**数据量的增长,（如，几十万，几百万的数量），树的高度会增加**，查询速度也会变得缓慢

如果一条数据在整个数的叶子节点，而高度为20，那么就需要20次的磁盘IO查找，才能找到该数据。

关键：**磁盘查找的次数与树的高度有关。**

## B-Tree

**数据页节点的引入，在横向放置更多的数据，来控制了树的高度**

默认页节点的大小，可以通过该sql进行查询

```mysql
# 页的大小sql
mysql> show global status like 'innodb_page_size';
+------------------+-------+
| Variable_name    | Value |
+------------------+-------+
| Innodb_page_size | 16384 |
+------------------+-------+
```

可以看到一个页的大小为16kb。如为bigint类型的字段建立索引，bigint为8B,地址分配的空间为6B



![image-20211026171434814](/images/MySQL/image-20211026171434814.png)

16KB/（8B+6B）约等于1170，也就是说可以存储1170个索引

![image-20211026172506634](/images/MySQL/image-20211026172506634.png)

而叶子节点包含data数据大概1KB，加起来是1kB,大概可以存储16个索引，所以可以存储的索引数据为1170x1170x16 = 21,902,400 ,大概两千万的索引，即两千万的数据量，而查找一条数据，只需要3次磁盘IO就可以了，因为深度h=3得到了控制。














---
sidebarDepth: 3
sidebar: auto
prev:
  text: Back To 目录
  link: /concurrency/
typora-root-url: ..\.vuepress\public
---



## volatile

volatile有两大特性，一是可见性，二是有序性，禁止指令重排序，其中可见性就是可以让线程之间进行通信

[Source Code](https://github.com/Q10Viking/learncode/blob/main/concurrency/src/main/java/org/hzz/basic/communicate/VolatileDemoTest.java)

```java
public class VolatileDemoTest {
    private static volatile boolean flag;
    public static void main(String[] args) {
        new Thread(()->{
            while(true){
                if(!flag){
                    System.out.printf("%s turn on\n",Thread.currentThread().getName());
                    flag = true;
                }
            }
        },"t1").start();

        new Thread(()->{
            while(true){
                if(flag){
                    System.out.printf("%s turn off\n",Thread.currentThread().getName());
                    flag = false;
                }
            }
        },"t2").start();
    }
}
/**
 * ...
 * t1 turn on
 * t2 turn off
 * t1 turn on
 * t2 turn off
 * t1 turn on
 * t2 turn off
 * ...
 */
```



## 管道输入输出流

管道输入/输出流和普通的文件输入/输出流或者网络输入/输出流不同之处在于，它主要用于线程之间的数据传输，而传输的媒介为内存。管道输入/输出流主要包括了如下4种具体实现：PipedOutputStream、PipedInputStream、PipedReader和PipedWriter，前两种面向字节，而后两种面向字符

[Source Code]()

```java
public class PipedDemo {
    public static void main(String[] args) throws IOException {
        PipedWriter out = new PipedWriter();
        PipedReader in = new PipedReader();
        // 将输出流和输入流进行连接，否则在使用时会抛出IOException
        out.connect(in);

        Thread printThread = new Thread(new Printer(in));
        printThread.start();

        int r = 0;
        try{
            while((r = System.in.read()) != -1){
                out.write(r);
            }
        }finally {
            out.close();
        }

    }


    static class Printer implements Runnable{
        private final PipedReader in;
        public Printer(PipedReader in){
            this.in = in;
        }
        @Override
        public void run() {
            int r = 0;
            try {
                while(((r = in.read()) != -1)) {
                    System.out.print((char)r);
                }
            } catch (IOException e) {
                throw new RuntimeException(e);
            }
        }
    }
}

```

![image-20230302191201697](/images/concurrency/image-20230302191201697.png)

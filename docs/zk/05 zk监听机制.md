---
sidebarDepth: 3
sidebar: auto
prev:
  text: Back To 目录
  link: /zk/
typora-root-url: ..\.vuepress\public
---



## zk事件监听

客户端注册监听它关心的任意节点，或者目录节点及递归子目录节点 

1. 如果注册的是对某个节点的监听，则当这个节点被删除，或者被修改时，对应的客户端将被通知
2. 如果注册的是对某个目录的监听，则当这个目录有子节点被创建，或者有子节点被删除，对应的客户端将被通知
3. 如果注册的是对某个目录的递归子节点进行监听，则当这个目录下面的任意子节点有目录结构的变化（有子节点被创建，或被删除）或者根节点有数据变化时，对应的客户端将被通知。

注意：**所有的通知都是一次性的**，及无论是对节点还是对目录进行的监听，一旦触发，对应的监听即被移除。递归子节点，监听是对所有子节点的，所以，每个子节点下面的事件同样只会被触发一次。



### 特性

| 特性           | 说明                                                         |
| -------------- | ------------------------------------------------------------ |
| 一次性触发     | watcher是一次性的，一旦被触发就会移除，再次使用时需要重新注册 |
| 客户端顺序回调 | watcher回调是顺序串行执行的，只有回调后客户端才能看到最新的数据状态。一个watcher回调逻辑不应该太多，以免影响别的watcher执行 |
| 轻量级         | WatchEvent是最小的通信单位，结构上只包含通知状态、事件类型和节点路径，并不会告诉数据节点变化前后的具体内容 |
| 时效性         | watcher只有在当前session彻底失效时才会无效，若在session有效期内快速重连成功，则watcher依然存在，仍可接收到通知； |

## 监听节点

<img src="/images/zk/image-20211118055024699.png" alt="image-20211118055024699" />



## 监听目录

<img src="/images/zk/image-20211118055257990.png" alt="image-20211118055257990" />

```sh
# 或者递归监听
ls -R -w /test
```



##  **Zookeeper事件类型**

1. `None`: 连接建立事件
2. `NodeCreated`： 节点创建
3. `NodeDeleted`： 节点删除
4. `NodeDataChanged`：节点数据变化
5. `NodeChildrenChanged`：子节点列表变化
6. `DataWatchRemoved`：节点监听被移除
7. `ChildWatchRemoved`：子节点监听被移除
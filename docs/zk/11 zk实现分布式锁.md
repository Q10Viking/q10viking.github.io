---
sidebarDepth: 3
sidebar: auto
prev:
  text: Back To 目录
  link: /zk/
typora-root-url: ..\.vuepress\public
---



> 分布式锁实战

## 非公平锁

::: tip

Zookeeper 分布式锁加锁原理

:::

如下实现方式在并发问题比较严重的情况下，性能会下降的比较厉害，主要原因是，所有的连接都在对同一个节点进行监听，❤️**当服务器检测到删除事件时，要通知所有的连接，所有的连接同时收到事件，再次并发竞争**❤️，这就是**羊群效应**。这种加锁方式是**非公平锁**的具体实现

> **Zookeeper事件类型**

1. `None`: 连接建立事件
2. `NodeCreated`： 节点创建
3. `NodeDeleted`： 节点删除
4. `NodeDataChanged`：节点数据变化
5. `NodeChildrenChanged`：子节点列表变化
6. `DataWatchRemoved`：节点监听被移除
7. `ChildWatchRemoved`：子节点监听被移除

![img](/images/zk/26596.png)



## 公平锁



借助于临时顺序节点，可以避免向上面非公平锁带来的同时多个节点的并发竞争锁的羊群效应，从而缓解了服务端压力。这种实现方式所有加锁请求都进行排队加锁，是**公平锁**的具体实现。

![img](/images/zk/26594.png)


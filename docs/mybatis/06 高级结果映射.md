---
sidebarDepth: 3
sidebar: auto
prev:
  text: Back To 目录
  link: /mybatis/
typora-root-url: ..\.vuepress\public
---

::: tip

[Source Code](https://github.com/Q10Viking/learncode/tree/main/mybatis/04_mybatis_advance_mapper)

:::



## 多对一

```sql
-- 查询所有用户对应的部门
SELECT
	E.*,
	D.dept_name 
FROM
	emp E
	LEFT JOIN dept D ON E.dept_id = D.dept_id
```

![image-20220807180353233](C:\Users\11930\AppData\Roaming\Typora\typora-user-images\image-20220807180353233.png)

### 普通模式

新建一个EmpDeptDTO,融合所有的字段

```xml
<resultMap id="query_emp_dept_map" type="org.hzz.pojo.EmpDeptDTO">
        <id column="id" property="id"></id>
        <result column="username" property="username"></result>
        <result column="dept_id" property="deptId"></result>
        <result column="dept_id" property="dept.deptId"></result>
        <result column="dept_name" property="dept.deptName"></result>
    </resultMap>
    <select id="selectEmpAndDept" resultMap="query_emp_dept_map">
        SELECT
            E.*,
            D.dept_name
        FROM
            emp E
                LEFT JOIN dept D ON E.dept_id = D.dept_id
    </select>
```

```java
List<EmpDeptDTO> selectEmpAndDept();
```



```sh
[
EmpDeptDTO{dept=Dept{deptId=1, deptName='经理'}} Emp{id=1, username='q10viking', deptId=1}, EmpDeptDTO{dept=Dept{deptId=2, deptName='普通员工'}} Emp{id=3, username='hzz', deptId=2}, EmpDeptDTO{dept=Dept{deptId=2, deptName='普通员工'}} Emp{id=4, username='静默', deptId=2}
]
```



### 使用association映射多对一

1. resultMap 调用已存在的映射,实现复用
2. **强制转换为多对一**，其底层原理需要依赖id进行组织,所以查询出数据的id
3. 当出现列名和resultMap指定的映射不一致的时候
   1. 自己指定result映射
   2. 重用resultMap方式的时候，可以使用columnPrefix="dept_"去掉前缀，前提条件是别名都加上统一的前缀

```xml
<resultMap id="query_emp_dept_map2" type="org.hzz.pojo.EmpDeptDTO">
        <id column="id" property="id"></id>
        <result column="username" property="username"></result>
        <result column="dept_id" property="deptId"></result>
        <!--
        association 实现多对一中的  “一”
            property 指定对象中的嵌套对象属性
            javaType 声明property的类型
            resultMap: 复用映射，DeptMapper的namespace.resultMap的id
        -->
        <association property="dept" javaType="org.hzz.pojo.Dept"
                     resultMap="org.hzz.mapper.DeptMapper.BaseResultMap">
        </association>
    </resultMap>
    <select id="selectEmpAndDeptUseAssociation" resultMap="query_emp_dept_map2">
        SELECT
            E.*,
            D.dept_name
        FROM
            emp E
                LEFT JOIN dept D ON E.dept_id = D.dept_id
    </select>
```


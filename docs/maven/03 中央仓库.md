---
sidebarDepth: 3
sidebar: auto
prev:
  text: Back To 目录
  link: /maven/
typora-root-url: ..\.vuepress\public
---



## maven默认的中央仓库

maven 默认的Central Repository中央仓库有两个[https://repo1.maven.org/maven2/](https://repo1.maven.org/maven2/) 和 [https://repo.maven.apache.org/maven2/](https://repo.maven.apache.org/maven2/)这两个都是存放jar包的地方

maven 2.0.11默认的中央仓库是`repo1.maven.org`,

```sh
Downloading: http://repo1.maven.org/maven2/org/apache/maven/plugins/maven-resources-plugin/2.3/maven-resources-plugin-2.3.pom
[WARNING] Unable to get resource 'org.apache.maven.plugins:maven-resources-plugin:pom:2.3' from repository central (http://repo1.maven.org/maven2): Error transferring file
```

但是会下载失败，因为`repo1.maven.org`已经从`http`升级为了`https`

--------------

maven 3.9.0默认的中央仓库是`repo.maven.apache.org`,对比上面的可以看到使用了`https`

```sh
Downloading from central: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-resources-plugin/3.3.0/maven-resources-plugin-3.3.0.pom
```

-----------------



## 阿里云Maven中央仓库

[仓库服务 (aliyun.com)](https://developer.aliyun.com/mvn/guide)

maven默认的中央仓库[https://repo1.maven.org](https://repo1.maven.org/) 和 [https://repo.maven.apache.org](https://repo.maven.apache.org/)在国外，国内下载很慢，所以一般都会使用阿里云来代理。

可以看到阿里云的central代理了`repo1.maven.org`中央仓库

一般我们使用central仓库，为什么？看下面接下来这篇文章对`mirrorOf`的分析

| 仓库名称         | 阿里云仓库地址                                       | 阿里云仓库地址(老版)                                         | 源地址                                   |
| :--------------- | :--------------------------------------------------- | :----------------------------------------------------------- | :--------------------------------------- |
| central          | https://maven.aliyun.com/repository/central          | https://maven.aliyun.com/nexus/content/repositories/central  | https://repo1.maven.org/maven2/          |
| jcenter          | https://maven.aliyun.com/repository/public           | https://maven.aliyun.com/nexus/content/repositories/jcenter  | http://jcenter.bintray.com/              |
| public           | https://maven.aliyun.com/repository/public           | https://maven.aliyun.com/nexus/content/groups/public         | central仓和jcenter仓的聚合仓             |
| google           | https://maven.aliyun.com/repository/google           | https://maven.aliyun.com/nexus/content/repositories/google   | https://maven.google.com/                |
| gradle-plugin    | https://maven.aliyun.com/repository/gradle-plugin    | https://maven.aliyun.com/nexus/content/repositories/gradle-plugin | https://plugins.gradle.org/m2/           |
| spring           | https://maven.aliyun.com/repository/spring           | https://maven.aliyun.com/nexus/content/repositories/spring   | http://repo.spring.io/libs-milestone/    |
| spring-plugin    | https://maven.aliyun.com/repository/spring-plugin    | https://maven.aliyun.com/nexus/content/repositories/spring-plugin | http://repo.spring.io/plugins-release/   |
| grails-core      | https://maven.aliyun.com/repository/grails-core      | https://maven.aliyun.com/nexus/content/repositories/grails-core | https://repo.grails.org/grails/core      |
| apache snapshots | https://maven.aliyun.com/repository/apache-snapshots | https://maven.aliyun.com/nexus/content/repositories/apache-snapshots | https://repository.apache.org/snapshots/ |





## plugin插件仓库

maven除了我们开发使用的jar包仓库，还有maven自身使用的插件jar，也需要从中央仓库下载。

::: tip

[Maven – POM Reference (apache.org)](https://maven.apache.org/pom.html#Plugin_Repositories)

Repositories are home to two major types of artifacts. The first are artifacts that are used as dependencies of other artifacts. These are the majority of plugins that reside within central. The other type of artifact is plugins. Maven plugins are themselves a special type of artifact. Because of this, plugin repositories may be separated from other repositories (although, I have yet to hear a convincing argument for doing so). In any case, the structure of the pluginRepositories element block is similar to the repositories element. The pluginRepository elements each specify a remote location of where Maven can find new plugins.

:::

打开IDEA，第一次使用maven时，会从默认仓库[https://repo.maven.apache.org/maven2/](https://repo.maven.apache.org/maven2/)下载maven命令需要的插件（比如clean、install都是maven的插件），走的还是使用默认的中央仓库，这样会很慢.

![image-20230517133945241](/images/maven/image-20230517133945241.png)

```sh
Downloading from central: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-resources-plugin/3.3.0/maven-resources-plugin-3.3.0.pom
Downloaded from central: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-resources-plugin/3.3.0/maven-resources-plugin-3.3.0.pom (8.5 kB at 6.7 kB/s)
```

我们使用阿里云的代理,在项目的`pom.xml`配置

```xml
<pluginRepositories>
    <pluginRepository>
        <!-- 定义个id,自己可以随便取名,可以日志中可以看到 -->
        <id>aliyun-plugin-hzz</id>
        <url>https://maven.aliyun.com/repository/public</url> <!-- 阿里云的maven仓库 -->
        <releases>
            <enabled>true</enabled> <!-- 是否开启发布包 -->
        </releases>
        <snapshots>
            <enabled>false</enabled> <!-- 是否开启快照包 -->
        </snapshots>
    </pluginRepository>
</pluginRepositories>
```

在项目中执行`mvn install`可以看到从阿里云下载了

```
Downloading from aliyun-plugin-hzz: https://maven.aliyun.com/repository/public/org/apache/maven/plugins/maven-resources-plugin/3.3.0/maven-resources-plugin-3.3.0.pom
Downloaded from aliyun-plugin-hzz: https://maven.aliyun.com/repository/public/org/apache/maven/plugins/maven-resources-plugin/3.3.0/maven-resources-plugin-3.3.0.pom
```



## 依赖的仓库

就是我们日常开发依赖的第三方jar包

```xml
    <dependencies>
        <dependency>
            <groupId>com.alibaba.fastjson2</groupId>
            <artifactId>fastjson2</artifactId>
            <version>2.0.32</version>
        </dependency>
    </dependencies>
```

默认是从中央仓库下载

```sh
Downloading from central: https://repo.maven.apache.org/maven2/com/alibaba/fastjson2/fastjson2/2.0.32/fastjson2-2.0.32.pom
Downloaded from central: https://repo.maven.apache.org/maven2/com/alibaba/fastjson2/fastjson2/2.0.32/fastjson2-2.0.32.pom (11 kB at 4.1 kB/s)
```

那么可以使用阿里云中央仓库加速加载，在项目pom.xml文件中配置

```xml
<repositories>
    <repository>
        <id>aliyun-hzz</id>
        <url>https://maven.aliyun.com/repository/public</url>
        <releases>
            <enabled>true</enabled>
        </releases>
        <snapshots>
            <enabled>false</enabled>
        </snapshots>
    </repository>
</repositories>
```

可以看到从阿里云仓库中下载了

```xml
Downloading from aliyun-hzz: https://maven.aliyun.com/repository/public/com/alibaba/fastjson2/fastjson2/2.0.32/fastjson2-2.0.32.pom
Downloaded from aliyun-hzz: https://maven.aliyun.com/repository/public/com/alibaba/fastjson2/fastjson2/2.0.32/fastjson2-2.0.32.pom (11 kB at 12 kB/s)
```



## maven setting.xml配置

上面的代码都是在项目中的pom.xml文件配置。好处是可以随着项目提交。别人下载下来就可以通过maven，快速下载jar包

坏处就是对于自己而言，每次创建新的项目的时候，都需要在项目中这样配置，会比较繁琐。所以可以在maven中的`setting.xml`中配置。这种方式也是在网上普遍看到的配置阿里云仓库的方式



### mirrorOf研究

```xml
<mirror>
    <id>aliyunmaven</id>
    <mirrorOf>*</mirrorOf>
    <name>阿里云公共仓库</name>
    <url>https://maven.aliyun.com/repository/public</url>
</mirror> 
```

> 插件去到了阿里中央仓库下载

```sh
Downloading from aliyunmaven: https://maven.aliyun.com/repository/public/org/apache/maven/plugins/maven-resources-plugin/3.3.0/maven-resources-plugin-3.3.0.pom
Downloaded from aliyunmaven: https://maven.aliyun.com/repository/public/org/apache/maven/plugins/maven-resources-plugin/3.3.0/maven-resources-plugin-3.3.0.pom (8.5 kB at 7.7 kB/s)
```

> 依赖的第三方jar包也到了阿里中央仓库下载

```xml
    <dependencies>
        <dependency>
            <groupId>com.alibaba.fastjson2</groupId>
            <artifactId>fastjson2</artifactId>
            <version>2.0.32</version>
        </dependency>
    </dependencies>
```

```xml
Downloading from aliyunmaven: https://maven.aliyun.com/repository/public/com/alibaba/fastjson2/fastjson2/2.0.32/fastjson2-2.0.32.jar
Downloaded from aliyunmaven: https://maven.aliyun.com/repository/public/com/alibaba/fastjson2/fastjson2/2.0.32/fastjson2-2.0.32.jar (1.9 MB at 2.5 MB/s)
```



> mirrorOf改为public,插件就从默认的中央仓库下载了，这是为什么？

```xml
<mirror>
    <id>aliyunmaven</id>
    <mirrorOf>public</mirrorOf>
    <name>阿里云公共仓库</name>
    <url>https://maven.aliyun.com/repository/public</url>
</mirror> 
```

```
Downloading from central: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-resources-plugin/3.3.0/maven-resources-plugin-3.3.0.pom
```

> mirrorOf改为central，使用到了阿里中央仓库

```xml
<mirror>
    <id>aliyunmaven</id>
    <mirrorOf>central</mirrorOf>
    <name>阿里云公共仓库</name>
    <url>https://maven.aliyun.com/repository/public</url>
</mirror> 
```

```sh
Downloading from aliyunmaven: https://maven.aliyun.com/repository/public/org/apache/maven/plugins/maven-resources-plugin/3.3.0/maven-resources-plugin-3.3.0.pom
Downloaded from aliyunmaven: https://maven.aliyun.com/repository/public/org/apache/maven/plugins/maven-resources-plugin/3.3.0/maven-resources-plugin-3.3.0.pom (8.5 kB at 8.3 kB/s)
```

### mirrorOf理解❤️❤️

到这里我们大概就明白了mirrorOf的作用。

从上面的例子，我们可以这么理解，默认情况下，maven下面的pom.xml的中央仓库，缺省了模板仓库id为`central`，url为maven中央仓库url：[https://repo.maven.apache.org](https://repo.maven.apache.org),也就是说maven，默认为我们项目的pom.xml文件配置了，如下：

```xml
<!-- 默认中央仓库地址 -->
<repositories>
    <repository>
        <id>central</id>
        <url>https://repo.maven.apache.org/maven2/</url>
    </repository>
</repositories> 
<!-- 默认的插件中央仓库地址 -->
<pluginRepositories>
    <pluginRepository>
        <id>central</id>
        <url>https://repo.maven.apache.org/maven2/</url>
    </pluginRepository>
</pluginRepositories>
```

当mifforOf为central时，匹配了默认的central，那么镜像就生效，下载依赖就从默认的中央仓库`https://repo.maven.apache.org/maven2/`到了阿里的镜像的地址`https://maven.aliyun.com/repository/public`下载

同理mirrorOf配置为`*`匹配所有，也会从对应的镜像地址下载

而mirrorOf配置为`public`,由于默认的`central`不等于`public`,所以没有使用阿里镜像



#### 验证

> 验证上面的想法

首先我们配置mirrorOf为public

```xml
<mirror>
    <id>aliyunmaven</id>
    <mirrorOf>public</mirrorOf>
    <name>阿里云公共仓库</name>
    <url>https://maven.aliyun.com/repository/public</url>
</mirror> 
```

1. maven不是有两个默认的中央仓库嘛。在maven3.9.0中使用的默认仓库是  [https://repo.maven.apache.org/maven2/](https://repo.maven.apache.org/maven2/)现在我们改为[https://repo1.maven.org/maven2/](https://repo1.maven.org/maven2/)

```xml
<repositories>
    <repository>
        <id>central</id>
        <url>https://repo1.maven.org/maven2/</url>
    </repository>
</repositories>
<pluginRepositories>
    <pluginRepository>
        <id>central</id>
        <url>https://repo1.maven.org/maven2/</url>
    </pluginRepository>
</pluginRepositories>
```

由于id=central不匹配mirrorOf=public,不会走镜像，会走我们配置的仓库，看效果



```sh
Downloading from central: https://repo1.maven.org/maven2/org/apache/maven/plugins/maven-resources-plugin/3.3.0/maven-resources-plugin-3.3.0.pom
Downloaded from central: https://repo1.maven.org/maven2/org/apache/maven/plugins/maven-resources-plugin/3.3.0/maven-resources-plugin-3.3.0.pom (8.5 kB at 2.3 kB/s)
```



## repo优先级todo

[(38条消息) 一文弄懂 maven 仓库, 仓库优先级, settings pom配置关系及差异_settings repositories_Peradastra的博客-CSDN博客](https://blog.csdn.net/taugast/article/details/113787531)



### 拉包原理TODO



https://developer.aliyun.com/article/1204369



# mirror镜像和repository远程仓库、mirrorof



https://www.jianshu.com/p/e7cedd9eaac7





## 完整

```xml
	<dependencies>
        <dependency>
            <groupId>com.alibaba.fastjson2</groupId>
            <artifactId>fastjson2</artifactId>
            <version>2.0.32</version>
        </dependency>
    </dependencies>

    <repositories>
        <repository>
            <id>aliyun-hzz</id>
            <url>https://maven.aliyun.com/repository/public</url>
            <releases>
                <enabled>true</enabled>
            </releases>
            <snapshots>
                <enabled>false</enabled>
            </snapshots>
        </repository>
    </repositories>

    <pluginRepositories>
        <pluginRepository>
            <!-- 定义个id,自己可以随便取名,在日志中可以看到 -->
            <id>aliyun-plugin-hzz</id>
            <url>https://maven.aliyun.com/repository/public</url> <!-- 阿里云的maven仓库 -->
            <releases>
                <enabled>true</enabled> <!-- 是否开启发布包 -->
            </releases>
            <snapshots>
                <enabled>false</enabled> <!-- 是否开启快照包 -->
            </snapshots>
        </pluginRepository>
    </pluginRepositories>
```





### 完整注释

[Maven: settings.xml、pom.xml完整配置-阿里云开发者社区 (aliyun.com)](https://developer.aliyun.com/article/813478)


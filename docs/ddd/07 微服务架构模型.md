---
sidebarDepth: 3
sidebar: auto
prev:
  text: Back To 目录
  link: /ddd/
typora-root-url: ..\.vuepress\public
---



## 整洁架构

整洁架构又名“洋葱架构”。整洁架构 的层就像洋葱片一样，它体现了分层的设计思想。

在整洁架构里，同心圆代表应用软件的不同部分，从里到外依次是领域模型、领域服务、应用服务和最外围的容易变化的内容，比如用户界面和基础设施。 

整洁架构最主要的原则是依赖原则，它定义了各层的依赖关系，越往里依赖越低，代码级别 越高，越是核心能力。外圆代码依赖只能指向内圆，内圆不需要知道外圆的任何情况。

![image-20230526201910500](/images/ddd/image-20230526201910500.png)

在洋葱架构中，各层的职能是这样划分的：

- 领域模型实现领域内核心业务逻辑，它封装了企业级的业务规则。领域模型的主体是实 体，一个实体可以是一个带方法的对象，也可以是一个数据结构和方法集合。
- 领域服务实现涉及多个实体的复杂业务逻辑。
- 应用服务实现与用户操作相关的服务组合与编排，它包含了应用特有的业务流程规则， 封装和实现了系统所有用例
- 最外层主要提供适配的能力，适配能力分为主动适配和被动适配。主动适配主要实现外 部用户、网页、批处理和自动化测试等对内层业务逻辑访问适配。被动适配主要是实现 核心业务逻辑对基础资源访问的适配，比如数据库、缓存、文件系统和消息中间件等
- 红圈内的领域模型、领域服务和应用服务一起组成软件核心业务能力





## 六边形架构

六边形架构又名“端口适配器架构”。追溯微服务架构的渊源，一般都会涉及到六边形架 构。 六边形架构的核心理念是：应用是通过端口与外部进行交互的。这也是微服务架构下 API 网关盛行的主要原因

在下图的六边形架构中，红圈内的核心业务逻辑（应用程序和领域模型）与外部 资源（包括 APP、Web 应用以及数据库资源等）完全隔离，仅通过适配器进行交互。它解 决了业务逻辑与用户界面的代码交错问题，很好地实现了前后端分离。六边形架构各层的依 赖关系与整洁架构一样，都是由外向内依赖

![image-20230526202526134](/images/ddd/image-20230526202526134.png)

六边形架构将系统分为内六边形和外六边形两层，这两层的职能划分如下

- 红圈内的六边形实现应用的核心业务逻辑
- 外六边形完成外部应用、驱动和基础资源等的交互和访问，对前端应用以 API 主动适配 的方式提供服务，对基础资源以依赖倒置被动适配的方式实现资源访问

六边形架构的一个端口可能对应多个外部系统，不同的外部系统也可能会使用不同的适配 器，由适配器负责协议转换。这就使得应用程序能够以一致的方式被用户、程序、自动化测 试和批处理脚本使用



## 三种微服务架构模型的对比和分析

![image-20230526202750285](/images/ddd/image-20230526202750285.png)

> 重点关注图中的红色线框，它们是非常重要的分界线，这三种架构里面都有，它的作用 就是将核心业务逻辑与外部应用、基础资源进行隔离

重点关注图中的红色线框，它们是非常重要的分界线，这三种架构里面都有，它的作用 就是将核心业务逻辑与外部应用、基础资源进行隔离

领域层实现面向领域模型，实现领域模型的核心业务逻辑，属于原子模型，它需要保持领域 模型和业务逻辑的稳定，对外提供稳定的细粒度的领域服务，所以它处于架构的核心位置

应用层实现面向用户操作相关的用例和流程，对外提供粗粒度的 API 服务。它就像一个齿 轮一样进行前台应用和领域层的适配，接收前台需求，随时做出响应和调整，尽量避免将前 台需求传导到领域层。应用层作为配速齿轮则位于前台应用和领域层之间

可以说，这三种架构都考虑了前端需求的变与领域模型的不变。需求变幻无穷，但变化总是 有矩可循的，用户体验、操作习惯、市场环境以及管理流程的变化，往往会导致界面逻辑和 流程的多变。但总体来说，不管前端如何变化，在企业没有大的变革的情况下，核心领域逻 辑基本不会大变，所以领域模型相对稳定，而用例和流程则会随着外部应用需求而随时调 整

架构模型通过分层的方式来控制需求变化从外到里对系统的影响，从外向里受需求影响逐步 减小。面向用户的前端可以快速响应外部需求进行调整和发布，灵活多变，应用层通过服务 组合和编排来实现业务流程的快速适配上线，减少传导到领域层的需求，使领域层保持长期 稳定

这样设计的好处很明显了，就是可以保证领域层的核心业务逻辑不会因为外部需求和流程的 变动而调整，对于建立前台灵活、中台稳固的架构很有帮助
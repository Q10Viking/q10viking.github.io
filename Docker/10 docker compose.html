<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/images/favicon-32x32.png"><title>静默のBlog</title><meta name="description" content="静默的Vuepress Blog">
    <link rel="preload" href="/assets/js/runtime~app.2c87fbe0.js" as="script"><link rel="preload" href="/assets/css/styles.b779b927.css" as="style"><link rel="preload" href="/assets/js/95615.aba5921d.js" as="script"><link rel="preload" href="/assets/js/app.4aafd1f6.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.b779b927.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">静默のBlog</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/topicNav/" class="nav-link" aria-label="📗Menu"><!--[--><!--]--> 📗Menu <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/aboutme/" class="nav-link" aria-label="AboutMe"><!--[--><!--]--> AboutMe <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/Q10Viking/q10viking.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/topicNav/" class="nav-link" aria-label="📗Menu"><!--[--><!--]--> 📗Menu <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/aboutme/" class="nav-link" aria-label="AboutMe"><!--[--><!--]--> AboutMe <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/Q10Viking/q10viking.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item"></p><ul class=""><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#docker-compose-容器编排" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Docker Compose（容器编排）"><!--[--><!--]--> Docker Compose（容器编排） <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#快速入门" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="快速入门"><!--[--><!--]--> 快速入门 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#docker-compose管理容器的结构" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Docker Compose管理容器的结构"><!--[--><!--]--> Docker Compose管理容器的结构 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#docker-compose-yml常用指令" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="docker-compose.yml常用指令"><!--[--><!--]--> docker-compose.yml常用指令 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#image" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="image"><!--[--><!--]--> image <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#build" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="build"><!--[--><!--]--> build <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#command" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="command"><!--[--><!--]--> command <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#links" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="links"><!--[--><!--]--> links <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#external-links" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="external_links"><!--[--><!--]--> external_links <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#ports" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ports"><!--[--><!--]--> ports <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#expose" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="expose"><!--[--><!--]--> expose <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#volumes" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="volumes"><!--[--><!--]--> volumes <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#volumes-from" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="volumes_from"><!--[--><!--]--> volumes_from <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#environments" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="environments"><!--[--><!--]--> environments <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#env-file" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="env_file"><!--[--><!--]--> env_file <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#extends" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="extends"><!--[--><!--]--> extends <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#net" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="net"><!--[--><!--]--> net <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#dns" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="dns"><!--[--><!--]--> dns <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/Docker/10%20docker%20compose.html#dns-search" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="dns_search"><!--[--><!--]--> dns_search <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="docker-compose-容器编排" tabindex="-1"><a class="header-anchor" href="#docker-compose-容器编排" aria-hidden="true">#</a> Docker Compose（容器编排）</h2><p>使用微服务架构的应用系统一般包含若干个微服务，每个微服务一般都会部署多个实例。如果每个微服务都要手动启停，那么效率之低、维护量之大可想而知。</p><blockquote><p>使用 Docker Compose来轻松、高效地管理容器</p></blockquote><p><a href="https://docs.docker.com/compose/" target="_blank" rel="noopener noreferrer">Docker Compose overview | Docker Documentation<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>q10viking@LAPTOP-PJLAUUSP:/$ <span class="token function">docker</span> compose version
Docker Compose version v2.15.1
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="快速入门" tabindex="-1"><a class="header-anchor" href="#快速入门" aria-hidden="true">#</a> 快速入门</h2><blockquote><p>文件结构</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>q10viking@LAPTOP-PJLAUUSP:~/learndocker/learncompose$ tree
<span class="token builtin class-name">.</span>
├── docker-compose.yml
└── eureka
    ├── Dockerfile
    └── microservice-eureka-server-0.0.1-SNAPSHOT.jar
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>在docker-compose.yml 中添加内容如下：</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>services:
  eureka:             <span class="token comment">#指定服务名</span>
    image: hzz-microservice-server:0.0.1  <span class="token comment">#指定镜像名称</span>
    build: ./eureka   <span class="token comment">#指定Dockfile所在路径</span>
    ports:
      - <span class="token string">&quot;8761:8761&quot;</span>   <span class="token comment">#指定端口映射</span>
    expose:
      - <span class="token number">8761</span>          <span class="token comment">#声明容器对外暴露的端口</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>启动</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> compose up （后面加-d可以后台启动<span class="token punctuation">)</span>     
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>q10viking@LAPTOP-PJLAUUSP:~/learndocker/learncompose$ <span class="token function">docker</span> compose up
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Running <span class="token number">2</span>/2
 ⠿ Network learncompose_default     Created                                                                        <span class="token number">0</span>.2s
 ⠿ Container learncompose-eureka-1  Created                                                                        <span class="token number">1</span>.0s
Attaching to learncompose-eureka-1
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/images/Docker/image-20230424130639588.png" alt="image-20230424130639588"></p><blockquote><p>docker compose会做以下几件事</p></blockquote><ul><li><p>创建一个默认的网络<code>learncompose_default</code>，默认以compose所在文件目录名加&quot;_default&quot;命名，compose内的所有容器都会加入此网络，可以相互用服务名访问。最好自定义一个网络。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>  <span class="token key atrule">redis-node6</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span><span class="token number">5.0</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>server <span class="token punctuation">-</span><span class="token punctuation">-</span>port 7005 <span class="token punctuation">-</span><span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>enabled yes <span class="token punctuation">-</span><span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>config<span class="token punctuation">-</span>file /data/nodes.conf <span class="token punctuation">-</span><span class="token punctuation">-</span>appendonly yes <span class="token punctuation">-</span><span class="token punctuation">-</span>bind 0.0.0.0
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;7005:7005&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;17005:17005&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./data/node6<span class="token punctuation">:</span>/data
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mynet		<span class="token comment"># 服务加入该网络</span>

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">mynet</span><span class="token punctuation">:</span>		<span class="token comment"># 自定义网络</span>
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge	<span class="token comment"># 使用桥接驱动</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li><li><p>如果镜像 <code>hzz-microservice-server:0.0.1</code> 不存在先构建镜像，如果镜像存在则不构建，加上 <strong>--build</strong> 参数可以强制先构建镜像，如果镜像之前构建过且构建文件没有变化或构建的内容没有变化，就算加上 <strong>--build</strong> 参数也不会重新构建</p></li><li><p>根据构建的镜像创建一个名称叫 <code>learncompose-eureka-1</code> 的容器</p></li><li><p>启动容器</p></li></ul><hr><h2 id="docker-compose管理容器的结构" tabindex="-1"><a class="header-anchor" href="#docker-compose管理容器的结构" aria-hidden="true">#</a> Docker Compose管理容器的结构</h2><blockquote><p>Docker Compose将所管理的容器分为三层，<strong>分别是工程（ project），服务（service）以及容器（ container)</strong></p></blockquote><ul><li><p>Docker Compose运行目录下的所有文件（ docker-compose.yml、 extends文件或环境变量文件等）组成一个工程（默认为 docker-compose.yml所在目录的目录名称）。一个工程可包含多个服务，每个服务中定义了容器运行的镜像、参数和依赖，一个服务可包括多个容器实例</p><blockquote><p>上面示例里工程名称是 docker-compose.yml 所在的目录名。该工程包含了1个服务，服务名称是 eureka，执行 docker-compose up时，启动了eureka服务的1个容器实例</p></blockquote></li><li><p>同一个docker compose内部的容器之间可以用服务名相互访问，<strong>服务名就相当于hostname，可以直接 ping 服务名，得到的就是服务对应容器的ip，如果服务做了扩容，一个服务对应了多个容器，则 ping 服务名 会轮询访问服务对应的每台容器ip ，docker底层用了LVS等技术帮我们实现这个负载均衡</strong></p></li></ul><hr><h2 id="docker-compose-yml常用指令" tabindex="-1"><a class="header-anchor" href="#docker-compose-yml常用指令" aria-hidden="true">#</a> docker-compose.yml常用指令</h2><p>文件官方文档：<a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/compose/compose-file/<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><h3 id="image" tabindex="-1"><a class="header-anchor" href="#image" aria-hidden="true">#</a> <strong>image</strong></h3><p>指定镜像名称或者镜像id，如果该镜像在本地不存在，Compose会尝试pull下来。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> image<span class="token operator">:</span> java<span class="token operator">:</span><span class="token number">8</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>​</p><h3 id="build" tabindex="-1"><a class="header-anchor" href="#build" aria-hidden="true">#</a> <strong>build</strong></h3><p>指定Dockerfile文件的路径。可以是一个路径，例如：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code> build: ./dir  
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>也可以是一个对象，用以指定Dockerfile和参数，例如：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>build:
  context: ./dir
  dockerfile: Dockerfile-alternate
  args:
    buildno: <span class="token number">1</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="command" tabindex="-1"><a class="header-anchor" href="#command" aria-hidden="true">#</a> <strong>command</strong></h3><p>覆盖容器启动后默认执行的命令。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>command: bundle <span class="token builtin class-name">exec</span> thin <span class="token parameter variable">-p</span> <span class="token number">3000</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>也可以是一个list，类似于Dockerfile总的CMD指令，格式如下</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>command: <span class="token punctuation">[</span>bundle, exec, thin, -p, <span class="token number">3000</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="links" tabindex="-1"><a class="header-anchor" href="#links" aria-hidden="true">#</a> <strong>links</strong></h3><p>显示链接到其他服务中的容器。可以指定服务名称和链接的别名使用SERVICE:ALIAS 的形式，或者只指定服务名称，</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>web:
  links:
   - db
   - db:database
   - redis
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="external-links" tabindex="-1"><a class="header-anchor" href="#external-links" aria-hidden="true">#</a> <strong>external_links</strong></h3><p>表示链接到docker-compose.yml外部的容器，甚至并非Compose管理的容器，特别是对于那些提供共享容器或共同服务。格式跟links类似，示例：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>external_links:
 - redis_1
 - project_db_1:mysql
 - project_db_1:postgresql
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="ports" tabindex="-1"><a class="header-anchor" href="#ports" aria-hidden="true">#</a> <strong>ports</strong></h3><p>暴露端口信息。使用宿主端口:容器端口的格式，或者仅仅指定容器的端口（此时宿主机将会随机指定端口），类似于docker run -p ，示例：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>ports:
 - <span class="token string">&quot;3000&quot;</span>
 - <span class="token string">&quot;3000-3005&quot;</span>
 - <span class="token string">&quot;8000:8000&quot;</span>
 - <span class="token string">&quot;9090-9091:8080-8081&quot;</span>
 - <span class="token string">&quot;49100:22&quot;</span>
 - <span class="token string">&quot;127.0.0.1:8001:8001&quot;</span>
 - <span class="token string">&quot;127.0.0.1:5000-5010:5000-5010&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="expose" tabindex="-1"><a class="header-anchor" href="#expose" aria-hidden="true">#</a> <strong>expose</strong></h3><p>暴露端口，只将端口暴露给连接的服务，而不暴露给宿主机，示例：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>expose:
 - <span class="token string">&quot;3000&quot;</span>
 - <span class="token string">&quot;8000&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="volumes" tabindex="-1"><a class="header-anchor" href="#volumes" aria-hidden="true">#</a> <strong>volumes</strong></h3><p>卷挂载路径设置。可以设置宿主机路径 <code>（HOST:CONTAINER）</code> 或加上访问模式 <code>（HOST:CONTAINER:ro）</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>volumes:
  <span class="token comment"># Just specify a path and let the Engine create a volume</span>
  - /var/lib/mysql

  <span class="token comment"># Specify an absolute path mapping</span>
  - /opt/data:/var/lib/mysql

  <span class="token comment"># Path on the host, relative to the Compose file</span>
  - ./cache:/tmp/cache

  <span class="token comment"># User-relative path</span>
  - ~/configs:/etc/configs/:ro

  <span class="token comment"># Named volume</span>
  - datavolume:/var/lib/mysql
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="volumes-from" tabindex="-1"><a class="header-anchor" href="#volumes-from" aria-hidden="true">#</a> <strong>volumes_from</strong></h3><p>从另一个服务或者容器挂载卷。可以指定只读或者可读写，如果访问模式没有指定，则默认是可读写。示例</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>volumes_from:
 - service_name
 - service_name:ro
 - container:container_name
 - container:container_name:rw
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="environments" tabindex="-1"><a class="header-anchor" href="#environments" aria-hidden="true">#</a> <strong>environment</strong>s</h3><p>设置环境变量。可以使用数组或者字典两种方式。只有一个key的环境变量可以在运行Compose的机器上找到对应的值，这有助于加密的或者特殊主机的值</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>environment:
  RACK_ENV: development
  SHOW: <span class="token string">&#39;true&#39;</span>
  SESSION_SECRET:

environment:
  - <span class="token assign-left variable">RACK_ENV</span><span class="token operator">=</span>development
  - <span class="token assign-left variable">SHOW</span><span class="token operator">=</span>true
  - SESSION_SECRET
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="env-file" tabindex="-1"><a class="header-anchor" href="#env-file" aria-hidden="true">#</a> <strong>env_file</strong></h3><p>从文件中获取环境变量，可以为单独的文件路径或列表。如果通过 docker-compose -f FILE 指定了模板文件，则 env_file 中路径会基于模板文件路径。如果有变量名称与 environment 指令冲突，则以envirment 为准</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>env_file: .env

env_file:
  - ./common.env
  - ./apps/web.env
  - /opt/secrets.env
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="extends" tabindex="-1"><a class="header-anchor" href="#extends" aria-hidden="true">#</a> <strong>extends</strong></h3><p>继承另一个服务，基于已有的服务进行扩展</p><h3 id="net" tabindex="-1"><a class="header-anchor" href="#net" aria-hidden="true">#</a> <strong>net</strong></h3><p>设置网络模式。示例：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>net: <span class="token string">&quot;bridge&quot;</span>
net: <span class="token string">&quot;host&quot;</span>
net: <span class="token string">&quot;none&quot;</span>
net: <span class="token string">&quot;container:[service name or container name/id]&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="dns" tabindex="-1"><a class="header-anchor" href="#dns" aria-hidden="true">#</a> <strong>dns</strong></h3><p>配置dns服务器。可以是一个值，也可以是一个列表</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>dns: <span class="token number">8.8</span>.8.8
dns:
  - <span class="token number">8.8</span>.8.8
  - <span class="token number">9.9</span>.9.9
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="dns-search" tabindex="-1"><a class="header-anchor" href="#dns-search" aria-hidden="true">#</a> <strong>dns_search</strong></h3><p>配置DNS的搜索域，可以是一个值，也可以是一个列表</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>dns_search: example.com
dns_search:
  - dc1.example.com
  - dc2.example.com
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/Docker/" class="nav-link router-link-active" aria-label="Back To 目录"><!--[--><!--]--> Back To 目录 <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.2c87fbe0.js" defer></script><script src="/assets/js/95615.aba5921d.js" defer></script><script src="/assets/js/app.4aafd1f6.js" defer></script>
  </body>
</html>
